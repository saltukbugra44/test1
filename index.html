<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ger√ßek√ßi 3D Fotosentez Modelleri üß¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f4 50%, #e8f0e8 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            height: 100vh;
            color: #2E7D32;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100vh;
        }

        #3d-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.95);
            color: #2E7D32;
            padding: 25px;
            border-radius: 20px;
            z-index: 100;
            min-width: 350px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(76,175,80,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        #controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 100;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            padding: 18px 28px;
            background: linear-gradient(45deg, #2E7D32, #4CAF50);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .control-btn:hover::before {
            left: 100%;
        }

        .control-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.6);
        }

        .control-btn.active {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            animation: activeGlow 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.8);
        }

        @keyframes activeGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 107, 53, 0.8); }
            50% { box-shadow: 0 0 50px rgba(255, 107, 53, 1); }
        }

        #molecule-detail {
            position: absolute;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.95);
            color: #2E7D32;
            padding: 25px;
            border-radius: 20px;
            z-index: 100;
            min-width: 300px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(76,175,80,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .molecule-info {
            position: absolute;
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 14px;
            pointer-events: none;
            z-index: 1000;
            transform: translate(-50%, -100%);
            opacity: 0;
            transition: opacity 0.4s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76,175,80,0.5);
        }

        .molecule-info.show {
            opacity: 1;
        }

        .info-item {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .info-label {
            font-weight: bold;
            color: #4CAF50;
            min-width: 120px;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f8f9fa 0%, #f1f3f4 50%, #e8f0e8 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.8s ease-out;
        }

        .loading-text {
            color: #4CAF50;
            font-size: 28px;
            margin-bottom: 40px;
            animation: loadingPulse 2s infinite;
            text-align: center;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        .loading-bar {
            width: 400px;
            height: 8px;
            background: rgba(76,175,80,0.2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #CDDC39);
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .loading-progress::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.6),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .phase-indicator {
            position: absolute;
            top: 30px;
            right: 30px;
            background: linear-gradient(45deg, #2E7D32, #4CAF50);
            color: white;
            padding: 20px 30px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            z-index: 100;
            backdrop-filter: blur(15px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            border: 2px solid rgba(139, 195, 74, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .phase-indicator:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.6);
        }

        .phase-explanation {
            position: absolute;
            top: 50%;
            left: 30px;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.95);
            color: #2E7D32;
            padding: 25px;
            border-radius: 20px;
            z-index: 200;
            max-width: 400px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(76,175,80,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .phase-explanation.show {
            opacity: 1;
            visibility: visible;
        }

        .phase-title {
            color: #4CAF50;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .phase-description {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .phase-process {
            background: rgba(76,175,80,0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
            margin-bottom: 15px;
        }

        .phase-molecules {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .molecule-badge {
            background: linear-gradient(45deg, #2E7D32, #4CAF50);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .visual-hint {
            position: absolute;
            background: rgba(255,255,255,0.9);
            color: #333;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            z-index: 150;
            animation: hintPulse 2s ease-in-out infinite;
            pointer-events: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        @keyframes hintPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #4CAF50;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(76,175,80,0.2);
            transform: rotate(90deg);
        }


        .phase-equation {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            color: #2E7D32;
            padding: 20px 35px;
            border-radius: 25px;
            z-index: 100;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(76,175,80,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            min-width: 400px;
            transition: all 0.5s ease;
        }

        .equation-title {
            font-size: 14px;
            color: #4CAF50;
            margin-bottom: 8px;
            font-family: 'Segoe UI', sans-serif;
            font-weight: normal;
        }

        .equation-formula {
            font-size: 20px;
            color: #1B5E20;
            letter-spacing: 1px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .equation-arrow {
            color: #FF6B35;
            font-size: 24px;
            margin: 0 15px;
            animation: arrowPulse 2s ease-in-out infinite;
        }

        @keyframes arrowPulse {
            0%, 100% { transform: scale(1); color: #FF6B35; }
            50% { transform: scale(1.2); color: #FF8A65; }
        }

        .molecule-part {
            display: inline-block;
            padding: 2px 6px;
            margin: 0 2px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .molecule-part:hover {
            background: rgba(76,175,80,0.2);
            transform: scale(1.1);
        }

        .reactant {
            color: #1976D2;
        }

        .product {
            color: #388E3C;
        }

        .catalyst {
            color: #F57C00;
            font-size: 14px;
            font-style: italic;
        }

        .atom-legend {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(255,255,255,0.95);
            color: #2E7D32;
            padding: 20px;
            border-radius: 15px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76,175,80,0.3);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .atom-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
        }

        @media (max-width: 768px) {
            #info-panel, #molecule-detail, .phase-explanation, .molecule-cards {
                width: calc(100% - 40px);
                position: relative;
                margin: 20px;
                transform: none;
            }
            
            .phase-explanation {
                top: auto;
                left: auto;
                max-width: none;
            }
            
            
            .phase-indicator {
                font-size: 16px;
                padding: 15px 20px;
                top: 15px;
                right: 15px;
            }
            
            #controls {
                flex-wrap: wrap;
                max-width: calc(100% - 40px);
                gap: 10px;
            }
            
            .control-btn {
                padding: 14px 20px;
                font-size: 14px;
            }
            
            .visual-hint {
                font-size: 12px;
                padding: 6px 12px;
                max-width: 80%;
                text-align: center;
                left: 50% !important;
                transform: translateX(-50%);
            }
            
            
            .phase-equation {
                position: relative;
                top: 10px;
                left: auto;
                transform: none;
                margin: 10px 20px;
                min-width: auto;
                width: calc(100% - 40px);
                font-size: 14px;
                padding: 15px 20px;
            }
            
            .equation-formula {
                font-size: 16px;
            }
            
            .equation-arrow {
                font-size: 20px;
                margin: 0 8px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-text">üß¨ Ger√ßek√ßi Molek√ºl Yapƒ±larƒ± Hazƒ±rlanƒ±yor...<br>
        <span style="font-size: 16px; opacity: 0.8;">Bilimsel verilerden detaylƒ± modeller olu≈üturuluyor</span></div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
    </div>
    
    <!-- A√ßƒ±lƒ±≈ü Kredisi Modal -->
    <div id="creditsModal" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 20000;
        backdrop-filter: blur(10px);
    ">
        <div style="
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #2E7D32;
            padding: 40px 50px;
            border-radius: 25px;
            text-align: center;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 3px solid #4CAF50;
            position: relative;
            animation: modalAppear 0.6s ease-out;
        ">
            <div style="font-size: 32px; margin-bottom: 20px;">üå±üß¨üî¨</div>
            <h2 style="color: #4CAF50; margin-bottom: 25px; font-size: 28px;">3D Fotosentez Sim√ºlasyonu</h2>
            <div style="background: rgba(76,175,80,0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                <h3 style="color: #2E7D32; margin-bottom: 15px; font-size: 20px;">üë®‚Äçüî¨ Bu Projeyi Hazƒ±rlayanlar:</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; color: #4CAF50;">üë®‚Äçüíª Saltuk Buƒüra Albayrak</div>
                        <div style="font-size: 14px; opacity: 0.8;">Proje Lideri & Geli≈ütirici</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; color: #4CAF50;">üë®‚Äçüî¨ Emir Nihat √áaƒülƒ±</div>
                        <div style="font-size: 14px; opacity: 0.8;">Bilimsel ƒ∞√ßerik</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; color: #4CAF50;">üë®‚Äçüé® Kaƒüan B√ºber</div>
                        <div style="font-size: 14px; opacity: 0.8;">Tasarƒ±m & G√∂rsel</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="font-weight: bold; color: #4CAF50;">üë®‚Äçüìö Ali Cin</div>
                        <div style="font-size: 14px; opacity: 0.8;">Ara≈ütƒ±rma & Test</div>
                    </div>
                </div>
            </div>
            <div style="font-size: 16px; margin: 20px 0; line-height: 1.6;">
                üéØ <strong>Nasƒ±l Kullanƒ±lƒ±r:</strong><br>
                ‚Ä¢ Molek√ºllerin √ºzerine tƒ±klayarak bilgi alƒ±n<br>
                ‚Ä¢ Saƒü taraftaki butonlarla detay modellerini ke≈üfedin<br>
                ‚Ä¢ Animasyonlarƒ± ba≈ülatƒ±p fotosentezi canlƒ± olarak izleyin
            </div>
            <button onclick="closeCreditsModal()" style="
                background: linear-gradient(45deg, #4CAF50, #66BB6A);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 25px;
                font-size: 18px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(76,175,80,0.3);
                margin-top: 10px;
            ">Sim√ºlasyonu Ba≈ülat üöÄ</button>
        </div>
    </div>
    
    <style>
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.7) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
    </style>

    <div id="container">
        <div class="phase-equation" id="phaseEquation">
            <div class="equation-title" id="equationTitle">I≈üƒ±ƒüa Baƒülƒ± Evre - Genel Denklem</div>
            <div class="equation-formula" id="equationFormula">
                <span class="molecule-part reactant">2H‚ÇÇO</span>
                <span>+</span>
                <span class="molecule-part reactant">I≈üƒ±k</span>
                <span>+</span>
                <span class="molecule-part reactant">ADP + Pi</span>
                <span>+</span>
                <span class="molecule-part reactant">NADP‚Å∫</span>
                <span class="equation-arrow">‚Üí</span>
                <span class="molecule-part product">ATP</span>
                <span>+</span>
                <span class="molecule-part product">NADPH</span>
                <span>+</span>
                <span class="molecule-part product">O‚ÇÇ</span>
            </div>
        </div>

        <div id="info-panel">
            <h3 style="color: #4CAF50; margin-bottom: 20px; font-size: 24px;">üå± Ger√ßek√ßi 3D Fotosentez Modelleri</h3>
            <div class="info-item">
                <span class="info-label">Aktif Faz:</span>
                <span id="current-phase">Hazƒ±rlanƒ±yor...</span>
            </div>
            <div class="info-item">
                <span class="info-label">Se√ßili Molek√ºl:</span>
                <span id="active-molecule">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">Molek√ºl Tipi:</span>
                <span id="molecule-type">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">Atom Sayƒ±sƒ±:</span>
                <span id="atom-count">-</span>
            </div>
        </div>


        <div class="phase-indicator" id="phaseIndicator" onclick="togglePhaseExplanation()">
            üìç I≈üƒ±ƒüa Baƒülƒ± Evre
        </div>

        <div class="phase-explanation" id="phaseExplanation">
            <button class="close-btn" onclick="hidePhaseExplanation()">√ó</button>
            <div class="phase-title" id="explanationTitle">
                ‚òÄÔ∏è <span>I≈üƒ±ƒüa Baƒülƒ± Evre</span>
            </div>
            <div class="phase-description" id="explanationDescription">
                Tilakoidlerde ger√ßekle≈üen ƒ±≈üƒ±k enerjisinin kimyasal enerjiye d√∂n√º≈üt√ºr√ºld√ºƒü√º a≈üama. ATP ve NADPH √ºretilir.
            </div>
            <div class="phase-process" id="explanationProcess">
                <strong>Bu Fazda Neler Oluyor:</strong><br>
                ‚Ä¢ Klorofil ƒ±≈üƒ±k emer ve elektronlar uyarƒ±lƒ±r<br>
                ‚Ä¢ Su molek√ºlleri par√ßalanƒ±r (2H‚ÇÇO ‚Üí 4H‚Å∫ + 4e‚Åª + O‚ÇÇ)<br>
                ‚Ä¢ Elektron ta≈üƒ±ma zinciri √ßalƒ±≈üƒ±r<br>
                ‚Ä¢ ATP ve NADPH sentezlenir
            </div>
            <div class="phase-molecules" id="explanationMolecules">
                <span class="molecule-badge">‚òÄÔ∏è I≈üƒ±k Enerjisi</span>
                <span class="molecule-badge">‚ö° ATP</span>
                <span class="molecule-badge">üß¨ NADPH</span>
            </div>
        </div>

        <div id="molecule-detail" style="display: none;">
            <h4 style="color: #4CAF50; margin-bottom: 15px;" id="detail-title">Molek√ºl Detayƒ±</h4>
            <div id="detail-formula" style="font-size: 18px; margin-bottom: 10px; font-family: monospace;"></div>
            <div id="detail-description" style="opacity: 0.9; line-height: 1.6;"></div>
            <div id="detail-atoms" style="margin-top: 15px;"></div>
        </div>

        <div class="atom-legend">
            <h4 style="color: #4CAF50; margin-bottom: 10px; font-size: 14px;">Atom Renk Kodlarƒ±</h4>
            <div class="legend-item">
                <div class="atom-color" style="background: #FF0000;"></div>
                <span>Oksijen (O)</span>
            </div>
            <div class="legend-item">
                <div class="atom-color" style="background: #FFFFFF;"></div>
                <span>Hidrojen (H)</span>
            </div>
            <div class="legend-item">
                <div class="atom-color" style="background: #404040;"></div>
                <span>Karbon (C)</span>
            </div>
            <div class="legend-item">
                <div class="atom-color" style="background: #0000FF;"></div>
                <span>Azot (N)</span>
            </div>
            <div class="legend-item">
                <div class="atom-color" style="background: #FFA500;"></div>
                <span>Fosfor (P)</span>
            </div>
            <div class="legend-item">
                <div class="atom-color" style="background: #00FF00;"></div>
                <span>Magnezyum (Mg)</span>
            </div>
        </div>

        <div id="controls">
            <button class="control-btn" id="playBtn">‚ñ∂Ô∏è Ba≈ülat</button>
            <button class="control-btn" id="pauseBtn">‚è∏Ô∏è Duraklat</button>
            <button class="control-btn" id="resetBtn">üîÑ Sƒ±fƒ±rla</button>
            <button class="control-btn" id="phaseBtn">‚è≠Ô∏è Sonraki Faz</button>
            <button class="control-btn" id="cameraBtn">üì∑ Kamera</button>
            <button class="control-btn" id="moleculeBtn">üß¨ Molek√ºl Detay</button>
        </div>
        
        <!-- Detaylƒ± Model Butonlarƒ± - Saƒü tarafta dikey -->
        <div id="detail-controls" style="
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
        ">
            <button class="detail-btn" onclick="showDetailModel('atpSynthase')" style="
                padding: 15px 20px;
                background: #FF9800;
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                min-width: 180px;
                text-align: center;
            ">‚ö° ATP Sentezi</button>
            
            
            <button class="detail-btn" onclick="showDetailModel('electronTransport')" style="
                padding: 15px 20px;
                background: #2196F3;
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                min-width: 180px;
                text-align: center;
            ">‚ö° Elektron Ta≈üƒ±ma</button>
            
            <button class="detail-btn" onclick="showDetailModel()" style="
                padding: 15px 20px;
                background: #607D8B;
                color: white;
                border: none;
                border-radius: 10px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                min-width: 180px;
                text-align: center;
            ">üåç Ana Sahne</button>
        </div>
        
        <style>
        .detail-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            opacity: 0.9;
        }
        
        .detail-btn.active {
            background: #FF5722 !important;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            #detail-controls {
                right: 10px;
                gap: 10px;
            }
            .detail-btn {
                min-width: 140px !important;
                padding: 12px 16px !important;
                font-size: 12px !important;
            }
        }
        </style>
    </div>

    <div class="molecule-info" id="moleculeTooltip"></div>
    <div class="visual-hint" id="visualHint" style="display: none;"></div>
    
    <!-- Dinamik Bilgi Modal -->
    <div id="infoModal" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 15000;
        backdrop-filter: blur(8px);
    ">
        <div id="infoModalContent" style="
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #2E7D32;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            border: 2px solid #4CAF50;
            position: relative;
            animation: infoAppear 0.4s ease-out;
        ">
            <button onclick="closeInfoModal()" style="
                position: absolute;
                top: 15px;
                right: 20px;
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                color: #666;
                padding: 5px;
                border-radius: 50%;
                width: 35px;
                height: 35px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
            ">√ó</button>
            <div id="infoContent"></div>
        </div>
    </div>
    
    <style>
        @keyframes infoAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        #infoModal button:hover {
            background: rgba(255,0,0,0.1);
            color: #ff4444;
        }
    </style>

    <!-- Three.js Libraries (non-module) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <!-- Three.js viewer script -->
    <script src="js/three-viewer.js"></script>
    <!-- Keep main app scripts -->
    <script defer src="js/main.js"></script>
    <script defer src="js/interactions.js"></script>
</head>
<body>
    <div id="container">
        <div id="3d-container"></div>
        <div id="info-panel">
            <h2>Fotosentez Modelleri</h2>
            <p>3D modelleri fare ile d√∂nd√ºrebilir ve yakƒ±nla≈ütƒ±rabilirsiniz.</p>
        </div>
            function showOverlay(title, message, extraHtml) {
                const overlay = document.createElement('div');
                overlay.id = 'loader-overlay';
                overlay.style.cssText = 'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.25);z-index:9999;font-family:Arial,Helvetica,sans-serif;';
                overlay.innerHTML = `\
                    <div style="background:#fff;padding:22px;border-radius:12px;max-width:820px;width:90%;text-align:left;box-shadow:0 12px 40px rgba(0,0,0,0.15);">\
                        <h2 style="margin:0 0 8px;color:#d32f2f;">${title}</h2>\
                        <p style="margin:0 0 12px;color:#333;">${message}</p>\
                        ${extraHtml || ''}\
                        <div style="margin-top:14px;text-align:right">\
                            <button id="overlay-reload" style="padding:8px 14px;margin-right:8px;border-radius:8px;border:none;background:#4caf50;color:#fff;cursor:pointer;">Yeniden Y√ºkle</button>\
                            <button id="overlay-close" style="padding:8px 14px;border-radius:8px;border:none;background:#e0e0e0;color:#333;cursor:pointer;">Kapat</button>\
                        </div>\
                    </div>`;
                document.documentElement.appendChild(overlay);
                document.getElementById('overlay-reload').addEventListener('click', () => location.reload());
                document.getElementById('overlay-close').addEventListener('click', () => overlay.remove());
            }

            // Small delay so scripts have time to load
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const usingFileProtocol = location.protocol === 'file:';
                    const babylonMissing = typeof BABYLON === 'undefined';
                    const viewerMissing = typeof window.moleculeViewer === 'undefined';

                    if (babylonMissing) {
                        const extra = `\
                            <details style="margin-top:8px">\
                                <summary style="cursor:pointer">Neden bu oluyor?</summary>\
                                <p style="margin:8px 0 0;color:#555">CDN √ºzerinden y√ºklenen k√ºt√ºphaneler aƒü, CORS veya file:// protokol√º gibi nedenlerle y√ºklenemeyebilir.</p>\
                            </details>\
                            <pre style="background:#f5f5f5;padding:12px;border-radius:6px;margin-top:10px;white-space:pre-wrap;color:#222">powershell -Command "& { Add-Type -AssemblyName System.Web; Start-Process 'powershell' -ArgumentList '-NoExit','-Command','cd \"%cd%\"; python -m http.server 8000' }"
\n# veya (PowerShell)
cd C:\\Users\\you\\path\\to\\FotosentezWebSitesi; php -S 127.0.0.1:8000
                            </pre>`;
                        showOverlay('Y√ºkleme Hatasƒ±', '3D k√ºt√ºphaneleri y√ºklenemedi. L√ºtfen internet baƒülantƒ±nƒ±zƒ± kontrol edin veya sayfayƒ± bir yerel sunucuda √ßalƒ±≈ütƒ±rƒ±n.', extra);
                        return;
                    }

                    if (usingFileProtocol && viewerMissing) {
                        const extra = `\
                            <p style="color:#555;margin-top:8px">Tarayƒ±cƒ±da doƒürudan dosyayƒ± a√ßtƒ±ƒüƒ±nƒ±z i√ßin bazƒ± scriptler y√ºklenemiyor. Projenizi yerel sunucuda √ßalƒ±≈ütƒ±rƒ±n:</p>\
                            <pre style="background:#f5f5f5;padding:12px;border-radius:6px;margin-top:10px;white-space:pre-wrap;color:#222"># PowerShell ile basit bir sunucu (Python y√ºkl√º ise)\ncd C:\\Users\\saltu\\YasliGuvenlikSistemi_TubitekProje\\FotosentezWebSitesi; python -m http.server 8000\n\n# Alternatif (PHP y√ºkl√ºyse)\nphp -S 127.0.0.1:8000</pre>`;
                        showOverlay('Yerel Dosya Protokol√º', 'Sayfa file:// protokol√º √ºzerinden a√ßƒ±ldƒ±; bazƒ± 3B k√ºt√ºphaneler y√ºklenemeyebilir. A≈üaƒüƒ±daki komutlardan birini √ßalƒ±≈ütƒ±rƒ±p tarayƒ±cƒ±da http://localhost:8000 adresini a√ßƒ±n.', extra);
                        return;
                    }

                    // If BABYLON exists but viewer failed to initialize, give targeted message
                    if (!viewerMissing && window.moleculeViewer && window.moleculeViewer.scene) {
                        // everything looks fine
                        return;
                    }

                    if (!viewerMissing && viewerMissing === false) {
                        // moleculeViewer exists but maybe errored; show log suggestion
                        showOverlay('Ba≈ülatma Hatasƒ±', '3D g√∂r√ºnt√ºleyici ba≈ülatƒ±lamadƒ±. L√ºtfen konsolu (F12) a√ßƒ±p hata mesajlarƒ±nƒ± kontrol edin. Yeniden denemek i√ßin sayfayƒ± yenileyin.');
                        return;
                    }
                }, 400);
            });
        })();
    </script>
    
    <!-- √ñzel script'ler -->
    <script src="js/molecule-viewer.js"></script>
    <script defer src="js/main.js"></script>
    <script defer src="js/interactions.js"></script>
</head>
<body>
    <div id="container">
        <div id="3d-container"></div>
        <div id="info-panel">
            <h2>Fotosentez Modelleri</h2>
            <p>3D modelleri fare ile d√∂nd√ºrebilir ve yakƒ±nla≈ütƒ±rabilirsiniz.</p>
        </div>
    </div>
    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let chloroplast, molecules = [];
        let photons = [], electrons = [];
        let isAnimating = false;
        let currentPhase = 0;
        let animationSpeed = 1;
        let cameraAngle = 0;
        let selectedMolecule = null;
        let energyLevel = 0; // Eksik deƒüi≈üken eklendi
        let infoModal = null; // Tƒ±klama bilgi sistemi i√ßin
        
        // Modal kapatma fonksiyonu
        function closeCreditsModal() {
            const modal = document.getElementById('creditsModal');
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.8)';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        // Fotosentez Ana Evreleri
        const phases = [
            "I≈üƒ±ƒüa Baƒülƒ± Evre", 
            "I≈üƒ±ktan Baƒüƒ±msƒ±z Evre (Calvin D√∂ng√ºs√º)"
        ];

        // Fotosentez Ana Evreleri A√ßƒ±klamalarƒ±
        const phaseExplanations = {
            0: {
                icon: "‚òÄÔ∏è",
                title: "I≈üƒ±ƒüa Baƒülƒ± Evre",
                description: "Tilakoidlerde ger√ßekle≈üen ƒ±≈üƒ±k enerjisinin kimyasal enerjiye d√∂n√º≈üt√ºr√ºld√ºƒü√º a≈üama. ATP ve NADPH √ºretilir.",
                process: "‚Ä¢ Klorofil ƒ±≈üƒ±k emer ve elektronlar uyarƒ±lƒ±r\n‚Ä¢ Su molek√ºlleri par√ßalanƒ±r (2H‚ÇÇO ‚Üí 4H‚Å∫ + 4e‚Åª + O‚ÇÇ)\n‚Ä¢ Elektron ta≈üƒ±ma zinciri √ßalƒ±≈üƒ±r\n‚Ä¢ ATP ve NADPH sentezlenir",
                molecules: [{name: "‚òÄÔ∏è I≈üƒ±k Enerjisi", color: "#FFD700"}, {name: "‚ö° ATP", color: "#4CAF50"}, {name: "üß¨ NADPH", color: "#9C27B0"}],
                hint: "I≈üƒ±k enerjisinin ATP ve NADPH'e d√∂n√º≈ü√ºm√ºn√º izleyin! ‚ú®"
            },
            1: {
                icon: "üîÑ",
                title: "I≈üƒ±ktan Baƒüƒ±msƒ±z Evre (Calvin D√∂ng√ºs√º)",
                description: "Stromada ger√ßekle≈üen, ATP ve NADPH kullanƒ±larak CO‚ÇÇ'den glukoz √ºretilen evre. I≈üƒ±ƒüa ihtiya√ß duymaz.",
                process: "‚Ä¢ CO‚ÇÇ atmosferden alƒ±nƒ±r\n‚Ä¢ RuBisCO enzimi CO‚ÇÇ'yi RuBP'ye baƒülar\n‚Ä¢ ATP ve NADPH enerji saƒülar\n‚Ä¢ Glukoz (C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ) sentezlenir",
                molecules: [{name: "üå¨Ô∏è CO‚ÇÇ", color: "#607D8B"}, {name: "üçØ Glukoz", color: "#FFC107"}, {name: "üå± RuBisCO", color: "#8BC34A"}],
                hint: "ATP ve NADPH'in glukoz √ºretiminde kullanƒ±mƒ±nƒ± izleyin! üçÉ"
            }
        };

        // Atom colors (CPK coloring scheme)
        const atomColors = {
            H: 0xFFFFFF,  // Hydrogen - White
            C: 0x404040,  // Carbon - Dark Gray
            N: 0x0000FF,  // Nitrogen - Blue
            O: 0xFF0000,  // Oxygen - Red
            P: 0xFFA500,  // Phosphorus - Orange
            S: 0xFFFF00,  // Sulfur - Yellow
            Mg: 0x00FF00  // Magnesium - Green
        };

        // Atom sizes (van der Waals radii scaled)
        const atomSizes = {
            H: 0.3,
            C: 0.4,
            N: 0.35,
            O: 0.35,
            P: 0.5,
            S: 0.45,
            Mg: 0.4
        };

        // Ger√ßek√ßi ve Detaylƒ± Molek√ºl Verileri
        const moleculeData = {
            water: {
                name: "Su Molek√ºl√º",
                formula: "H‚ÇÇO",
                description: "Fotosentezde elektron kaynaƒüƒ± olarak kullanƒ±lƒ±r ve par√ßalanarak oksijen √ºretir.",
                atoms: [
                    { element: 'O', position: [0, 0, 0] },
                    { element: 'H', position: [0.76, 0.59, 0] },
                    { element: 'H', position: [-0.76, 0.59, 0] }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'single' },
                    { from: 0, to: 2, type: 'single' }
                ],
                role: "reaktant",
                phase: "light_dependent"
            },
            co2: {
                name: "Karbondioksit",
                formula: "CO‚ÇÇ",
                description: "Calvin d√∂ng√ºs√ºnde karbon fiksasyonu i√ßin kullanƒ±lan ana karbon kaynaƒüƒ±.",
                atoms: [
                    { element: 'C', position: [0, 0, 0] },
                    { element: 'O', position: [-1.16, 0, 0] },
                    { element: 'O', position: [1.16, 0, 0] }
                ],
                bonds: [
                    { from: 0, to: 1, type: 'double' },
                    { from: 0, to: 2, type: 'double' }
                ],
                role: "reaktant",
                phase: "light_independent"
            },
            oxygen: {
                name: "Oksijen Gazƒ±",
                formula: "O‚ÇÇ",
                description: "Su molek√ºl√ºn√ºn par√ßalanmasƒ± sonucu olu≈üan yan √ºr√ºn.",
                atoms: [
                    { element: 'O', position: [-0.6, 0, 0] },
                    { element: 'O', position: [0.6, 0, 0] }
                ],
                bonds: [{ from: 0, to: 1, type: 'double' }],
                role: "urun",
                phase: "light_dependent"
            },
            atp: {
                name: "Adenozin Trifosfat",
                formula: "ATP",
                description: "H√ºcrenin enerji para birimi. Fotosentezde √ºretilen ana enerji ta≈üƒ±yƒ±cƒ±sƒ±.",
                atoms: [
                    // Adenin bazƒ±
                    { element: 'N', position: [0, 0, 0] },
                    { element: 'C', position: [1.2, 0, 0] },
                    { element: 'C', position: [0.6, 1.0, 0] },
                    { element: 'N', position: [-0.6, 1.0, 0] },
                    { element: 'C', position: [-1.2, 0, 0] },
                    { element: 'N', position: [-0.6, -1.0, 0] },
                    // Riboz ≈üeker
                    { element: 'C', position: [2.5, 0, 0] },
                    { element: 'C', position: [3.2, -0.8, 0] },
                    { element: 'C', position: [3.2, 0.8, 0] },
                    { element: 'O', position: [3.8, 0, 0] },
                    // Fosfat gruplarƒ±
                    { element: 'P', position: [5.0, 0, 0] },
                    { element: 'P', position: [6.5, 0, 0] },
                    { element: 'P', position: [8.0, 0, 0] },
                    { element: 'O', position: [5.0, 1.2, 0] },
                    { element: 'O', position: [6.5, 1.2, 0] },
                    { element: 'O', position: [8.0, 1.2, 0] }
                ],
                bonds: [
                    { from: 0, to: 1 }, { from: 1, to: 2 }, { from: 2, to: 3 },
                    { from: 3, to: 4 }, { from: 4, to: 5 }, { from: 5, to: 0 },
                    { from: 1, to: 6 }, { from: 6, to: 7 }, { from: 7, to: 8 },
                    { from: 8, to: 9 }, { from: 9, to: 6 }, { from: 6, to: 10 },
                    { from: 10, to: 11 }, { from: 11, to: 12 },
                    { from: 10, to: 13 }, { from: 11, to: 14 }, { from: 12, to: 15 }
                ],
                role: "urun",
                phase: "light_dependent"
            },
            nadph: {
                name: "NADPH",
                formula: "NADPH",
                description: "Redoks potansiyeli y√ºksek enerji ta≈üƒ±yƒ±cƒ±sƒ±. Calvin d√∂ng√ºs√ºnde indirgeyici olarak kullanƒ±lƒ±r.",
                atoms: [
                    { element: 'N', position: [0, 0, 0] },
                    { element: 'C', position: [1.4, 0, 0] },
                    { element: 'C', position: [0.7, 1.2, 0] },
                    { element: 'C', position: [-0.7, 1.2, 0] },
                    { element: 'C', position: [-1.4, 0, 0] },
                    { element: 'C', position: [-0.7, -1.2, 0] },
                    { element: 'C', position: [0.7, -1.2, 0] },
                    { element: 'P', position: [3.0, 0, 0] },
                    { element: 'P', position: [4.5, 0, 0] }
                ],
                bonds: [
                    { from: 0, to: 1 }, { from: 1, to: 2 }, { from: 2, to: 3 },
                    { from: 3, to: 4 }, { from: 4, to: 5 }, { from: 5, to: 6 },
                    { from: 6, to: 0 }, { from: 1, to: 7 }, { from: 7, to: 8 }
                ],
                role: "urun",
                phase: "light_dependent"
            },
            chlorophyll: {
                name: "Klorofil A",
                formula: "C‚ÇÖ‚ÇÖH‚Çá‚ÇÇO‚ÇÖN‚ÇÑMg",
                description: "ƒ∞≈üƒ±k enerjisini absorbe eden ana pigment molek√ºl√º. Fotosentezin kalbi.",
                atoms: [
                    // Merkezi magnezyum
                    { element: 'Mg', position: [0, 0, 0] },
                    // Porfirin halkasƒ± - 4 azot atomu
                    { element: 'N', position: [2.0, 0, 0] },
                    { element: 'N', position: [0, 2.0, 0] },
                    { element: 'N', position: [-2.0, 0, 0] },
                    { element: 'N', position: [0, -2.0, 0] },
                    // Pirol halka sistemleri
                    { element: 'C', position: [2.8, 1.2, 0] },
                    { element: 'C', position: [2.8, -1.2, 0] },
                    { element: 'C', position: [1.2, 2.8, 0] },
                    { element: 'C', position: [-1.2, 2.8, 0] },
                    { element: 'C', position: [-2.8, 1.2, 0] },
                    { element: 'C', position: [-2.8, -1.2, 0] },
                    { element: 'C', position: [-1.2, -2.8, 0] },
                    { element: 'C', position: [1.2, -2.8, 0] },
                    // Fitol kuyruk ba≈ülangƒ±cƒ±
                    { element: 'C', position: [4.0, 0, 0] },
                    { element: 'C', position: [5.2, 0, 0] },
                    { element: 'C', position: [6.4, 0, 0] },
                    // Ester baƒüƒ± i√ßin oksijen
                    { element: 'O', position: [3.6, 0.8, 0] }
                ],
                bonds: [
                    // Mg-N baƒülarƒ±
                    { from: 0, to: 1 }, { from: 0, to: 2 }, { from: 0, to: 3 }, { from: 0, to: 4 },
                    // Porfirin halka baƒülarƒ±
                    { from: 1, to: 5 }, { from: 1, to: 6 }, { from: 2, to: 7 }, { from: 2, to: 8 },
                    { from: 3, to: 9 }, { from: 3, to: 10 }, { from: 4, to: 11 }, { from: 4, to: 12 },
                    // Fitol kuyruk baƒülarƒ±
                    { from: 1, to: 13 }, { from: 13, to: 14 }, { from: 14, to: 15 },
                    { from: 13, to: 16 }
                ],
                role: "katalizor",
                phase: "light_dependent"
            },
            glucose: {
                name: "Glukoz",
                formula: "C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ",
                description: "Fotosentezin nihai √ºr√ºn√º. Bitki i√ßin enerji kaynaƒüƒ± ve yapƒ± ta≈üƒ±.",
                atoms: [
                    // Glukoz halka yapƒ±sƒ±
                    { element: 'C', position: [0, 0, 0] },
                    { element: 'C', position: [1.4, 0.8, 0] },
                    { element: 'C', position: [2.2, -0.4, 0] },
                    { element: 'C', position: [1.4, -1.6, 0] },
                    { element: 'C', position: [0, -2.4, 0] },
                    { element: 'O', position: [-0.8, -1.2, 0] }, // Halka oksijeni
                    // Hidroksil gruplarƒ±
                    { element: 'O', position: [-1.0, 0.8, 0] },
                    { element: 'O', position: [1.4, 2.0, 0] },
                    { element: 'O', position: [3.4, -0.4, 0] },
                    { element: 'O', position: [1.4, -2.8, 0] },
                    { element: 'O', position: [0, -3.6, 0] },
                    // CH2OH grubu
                    { element: 'C', position: [-0.8, -3.2, 0] },
                    { element: 'O', position: [-2.0, -3.8, 0] }
                ],
                bonds: [
                    { from: 0, to: 1 }, { from: 1, to: 2 }, { from: 2, to: 3 },
                    { from: 3, to: 4 }, { from: 4, to: 5 }, { from: 5, to: 0 },
                    { from: 0, to: 6 }, { from: 1, to: 7 }, { from: 2, to: 8 },
                    { from: 3, to: 9 }, { from: 4, to: 10 }, { from: 4, to: 11 },
                    { from: 11, to: 12 }
                ],
                role: "urun",
                phase: "light_independent"
            }
        };

        // Fotosentez Ana Evreleri Denklemleri
        const phaseEquations = {
            0: {
                title: "I≈üƒ±ƒüa Baƒülƒ± Evre - Genel Denklem",
                formula: [
                    {text: "2H‚ÇÇO", type: "reactant"},
                    {text: "+", type: "operator"},
                    {text: "I≈üƒ±k", type: "reactant"},
                    {text: "+", type: "operator"},
                    {text: "ADP + Pi", type: "reactant"},
                    {text: "+", type: "operator"},
                    {text: "NADP‚Å∫", type: "reactant"},
                    {text: "‚Üí", type: "arrow"},
                    {text: "ATP", type: "product"},
                    {text: "+", type: "operator"},
                    {text: "NADPH", type: "product"},
                    {text: "+", type: "operator"},
                    {text: "O‚ÇÇ", type: "product"}
                ]
            },
            1: {
                title: "I≈üƒ±ktan Baƒüƒ±msƒ±z Evre - Calvin D√∂ng√ºs√º",
                formula: [
                    {text: "6CO‚ÇÇ", type: "reactant"},
                    {text: "+", type: "operator"},
                    {text: "12ATP", type: "reactant"},
                    {text: "+", type: "operator"},
                    {text: "12NADPH", type: "reactant"},
                    {text: "‚Üí", type: "arrow"},
                    {text: "C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ", type: "product"},
                    {text: "+", type: "operator"},
                    {text: "12ADP", type: "product"},
                    {text: "+", type: "operator"},
                    {text: "12NADP‚Å∫", type: "product"},
                    {text: "RuBisCO", type: "catalyst"}
                ]
            }
        };


        // Detaylƒ± model durumlarƒ±
        let currentDetailModel = null;
        let detailModels = {};
        
        // Initialize everything with error handling
        window.addEventListener('load', function() {
            try {
                // G√ºvenlik kontrol√º
                if (typeof THREE === 'undefined') {
                    throw new Error('Three.js y√ºklenemedi');
                }
                
                simulateLoading();
            } catch (error) {
                console.error('Y√ºkleme hatasƒ±:', error);
                showErrorMessage('3D k√ºt√ºphaneleri y√ºklenemedi. L√ºtfen sayfayƒ± yenileyin.');
            }
        });
        
        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.innerHTML = `
                <div style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #f44336;
                    color: white;
                    padding: 2rem;
                    border-radius: 10px;
                    text-align: center;
                    z-index: 10001;
                    font-family: Arial, sans-serif;
                ">
                    <h3>‚ö†Ô∏è Y√ºkleme Hatasƒ±</h3>
                    <p>${message}</p>
                    <button onclick="location.reload()" style="
                        background: white;
                        color: #f44336;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: bold;
                    ">Sayfayƒ± Yenile</button>
                </div>
            `;
            document.body.appendChild(errorDiv);
            
            // Loading screen'i gizle
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
        }

        let loadingProgress = 0;
        
        function updateLoadingProgress(targetProgress) {
            const progress = document.getElementById('loadingProgress');
            loadingProgress = targetProgress;
            progress.style.width = loadingProgress + '%';
        }
        
        function simulateLoading() {
            const progress = document.getElementById('loadingProgress');
            updateLoadingProgress(10);
            
            // Ger√ßek y√ºkleme i≈ülemini ba≈ülat
            setTimeout(() => {
                init3DScene();
            }, 1000);
        }
        
        function finishLoading() {
            updateLoadingProgress(100);
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    console.log('‚úÖ Site hazƒ±r!');
                }, 800);
            }, 500);
        }

        function init3DScene() {
            try {
                console.log('üîÑ 3D Scene y√ºkleniyor...');
                updateLoadingProgress(20);
                
                // Scene setup - optimized
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf8f9fa);
                // Fog kaldƒ±rƒ±ldƒ± - performance i√ßin
                
                updateLoadingProgress(30);
                
                // Camera setup
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 15, 25);
                
                updateLoadingProgress(40);
                
                // Renderer setup - optimized for performance
                renderer = new THREE.WebGLRenderer({ 
                    antialias: false, // Daha hƒ±zlƒ± render i√ßin kapalƒ±
                    alpha: false,
                    powerPreference: "high-performance",
                    precision: "mediump" // Daha az hassasiyet, daha y√ºksek performans
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = false; // Shadow'lar kapatƒ±ldƒ± - performance i√ßin
                // Tone mapping sadele≈ütirildi
                renderer.outputEncoding = THREE.sRGBEncoding;
                
                updateLoadingProgress(50);
                document.getElementById('container').appendChild(renderer.domElement);

                // Controls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.08;
                controls.maxDistance = 100;
                controls.minDistance = 10;
                
                updateLoadingProgress(60);
                
                // Lighting - optimized
                setupOptimizedLighting();
                
                updateLoadingProgress(70);
                
                // Create realistic molecules with detailed structures
                createRealisticMolecules();
                
                updateLoadingProgress(80);
                
                createRealisticChloroplast();
                
                updateLoadingProgress(90);
                
                setupEventListeners();
                
                // Start render loop
                animate();
                updatePhaseInfo();
                updatePhaseExplanation();
                updatePhaseEquation();
                
                finishLoading();
                
            } catch (error) {
                console.error('3D Scene y√ºkleme hatasƒ±:', error);
                document.getElementById('loadingScreen').style.display = 'none';
                alert('3D sahne y√ºklenirken hata olu≈ütu. L√ºtfen sayfayƒ± yenileyin.');
            }
        }

        function setupOptimizedLighting() {
            // Sadece temel ƒ±≈üƒ±klandƒ±rma - performans i√ßin
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            // Tek directional light
            const sunLight = new THREE.DirectionalLight(0xffffff, 1.0);
            sunLight.position.set(30, 30, 20);
            // Shadow devre dƒ±≈üƒ± - performance i√ßin
            scene.add(sunLight);
            
            console.log('‚úÖ Optimized lighting kuruldu');
        }

        function createRealisticMolecules() {
            console.log('üß¨ Ger√ßek√ßi molek√ºller olu≈üturuluyor...');
            
            // Ba≈ülangƒ±√ß molek√ºlleri - kontroll√º ≈üekilde
            const initialMolecules = {
                // ƒ∞≈üƒ±ƒüa baƒülƒ± evre molek√ºlleri
                water: { count: 6, positions: [[8, 3, 5], [12, -2, 8], [-8, 4, -3], [-12, -1, 6], [15, 1, -4], [6, -5, 10]] },
                chlorophyll: { count: 8, positions: [] }, // Tilakoidlerde otomatik yerle≈ütirilecek
                
                // Calvin d√∂ng√ºs√º molek√ºlleri
                co2: { count: 4, positions: [[20, 10, 15], [-20, 8, 12], [18, -8, -10], [-15, -6, 14]] },
            };

            // Su molek√ºllerini olu≈ütur
            initialMolecules.water.positions.forEach((pos, i) => {
                try {
                    const molecule = createDetailedMolecule(moleculeData.water);
                    molecule.position.set(...pos);
                    molecule.userData = {
                        type: 'water',
                        data: moleculeData.water,
                        originalPosition: new THREE.Vector3(...pos),
                        id: `water_${i}`,
                        state: 'stable',
                        canSplit: true
                    };
                    
                    scene.add(molecule);
                    molecules.push(molecule);
                } catch (error) {
                    console.warn('Su molek√ºl√º hatasƒ±:', error);
                }
            });
            
            // Klorofil molek√ºllerini tilakoidlere yerle≈ütir
            const thylakoids = scene.children.filter(obj => 
                obj.children && obj.children.some(child => child.userData.type === 'thylakoid')
            );
            
            thylakoids.forEach((granaGroup, granaIndex) => {
                granaGroup.children.forEach((thylakoid, thylakoidIndex) => {
                    if (thylakoid.userData.type === 'thylakoid') {
                        // Her tilakoidde 2-3 klorofil molek√ºl√º
                        const chlorophyllCount = 2 + Math.floor(Math.random() * 2);
                        for (let i = 0; i < chlorophyllCount; i++) {
                            try {
                                const chlorophyll = createDetailedMolecule(moleculeData.chlorophyll);
                                const offset = new THREE.Vector3(
                                    (Math.random() - 0.5) * 2,
                                    (Math.random() - 0.5) * 0.3,
                                    (Math.random() - 0.5) * 2
                                );
                                chlorophyll.position.copy(thylakoid.position.clone().add(offset));
                                chlorophyll.scale.set(0.3, 0.3, 0.3); // Daha k√º√ß√ºk boyut
                                chlorophyll.userData = {
                                    type: 'chlorophyll',
                                    data: moleculeData.chlorophyll,
                                    granaIndex: granaIndex,
                                    thylakoidIndex: thylakoidIndex,
                                    id: `chlorophyll_${granaIndex}_${thylakoidIndex}_${i}`,
                                    state: 'ground', // ground, excited
                                    canAbsorbLight: true
                                };
                                
                                scene.add(chlorophyll);
                                molecules.push(chlorophyll);
                            } catch (error) {
                                console.warn('Klorofil hatasƒ±:', error);
                            }
                        }
                    }
                });
            });
            
            // CO2 molek√ºllerini olu≈ütur
            initialMolecules.co2.positions.forEach((pos, i) => {
                try {
                    const molecule = createDetailedMolecule(moleculeData.co2);
                    molecule.position.set(...pos);
                    molecule.userData = {
                        type: 'co2',
                        data: moleculeData.co2,
                        originalPosition: new THREE.Vector3(...pos),
                        id: `co2_${i}`,
                        state: 'free',
                        canBeFixed: true
                    };
                    
                    scene.add(molecule);
                    molecules.push(molecule);
                } catch (error) {
                    console.warn('CO2 molek√ºl√º hatasƒ±:', error);
                }
            });
            
            console.log(`‚úÖ ${molecules.length} ger√ßek√ßi molek√ºl olu≈üturuldu`);
            
            // Detaylƒ± enzim modellerini olu≈ütur
            createDetailedEnzymeModels();
        }
        
        function createDetailedEnzymeModels() {
            console.log('üîß Detaylƒ± enzim modelleri olu≈üturuluyor...');
            
            // ATP Synthase modeli olu≈ütur
            detailModels.atpSynthase = createATPSynthaseModel();
            detailModels.atpSynthase.visible = false;
            scene.add(detailModels.atpSynthase);
            
            
            // Elektron Ta≈üƒ±ma Zinciri modeli olu≈ütur
            detailModels.electronTransport = createElectronTransportModel();
            detailModels.electronTransport.visible = false;
            scene.add(detailModels.electronTransport);
            
            console.log('‚úÖ Enzim modelleri hazƒ±r');
        }
        
        function createATPSynthaseModel() {
            const synthaseGroup = new THREE.Group();
            synthaseGroup.userData.type = 'atp_synthase';
            synthaseGroup.position.set(0, 0, 0);
            
            // Tilakoid Membranƒ± (Ger√ßek√ßi kalƒ±nlƒ±k)
            const membrane = new THREE.Mesh(
                new THREE.BoxGeometry(25, 0.8, 15),
                new THREE.MeshPhongMaterial({
                    color: 0x2E7D32,
                    shininess: 30,
                    transparent: true,
                    opacity: 0.8
                })
            );
            membrane.position.set(0, 0, 0);
            synthaseGroup.add(membrane);
            
            // F1 Motor (Hexagonal ≈üekil - Œ±3Œ≤3 yapƒ±sƒ±)
            const f1Group = new THREE.Group();
            f1Group.position.set(0, 2.5, 0);
            
            // 6 alt birim (Œ± ve Œ≤ subunitleri)
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * Math.PI * 2;
                const isAlpha = i % 2 === 0;
                
                const subunitGeometry = new THREE.BoxGeometry(1.2, 2.4, 1.2);
                const subunitMaterial = new THREE.MeshPhongMaterial({
                    color: isAlpha ? 0x1976D2 : 0xF57C00, // Mavi Œ±, Turuncu Œ≤
                    shininess: 60,
                    emissive: isAlpha ? 0x0D47A1 : 0xE65100,
                    emissiveIntensity: 0.1
                });
                
                const subunit = new THREE.Mesh(subunitGeometry, subunitMaterial);
                subunit.position.set(
                    Math.cos(angle) * 2.2,
                    0,
                    Math.sin(angle) * 2.2
                );
                subunit.userData.type = isAlpha ? 'alpha' : 'beta';
                subunit.userData.angle = angle;
                
                // ATP Baƒülanma Cebi (Œ≤ subunitlerinde)
                if (!isAlpha) {
                    const pocket = new THREE.Mesh(
                        new THREE.SphereGeometry(0.3, 12, 8),
                        new THREE.MeshBasicMaterial({
                            color: 0x4CAF50,
                            emissive: 0x2E7D32,
                            emissiveIntensity: 0.4
                        })
                    );
                    pocket.position.set(0, 0.8, 0.6);
                    subunit.add(pocket);
                    
                    // ATP molek√ºl√º sim√ºlasyonu
                    const atpMolecule = new THREE.Mesh(
                        new THREE.OctahedronGeometry(0.15),
                        new THREE.MeshBasicMaterial({
                            color: 0x00E676,
                            emissive: 0x00C853,
                            emissiveIntensity: 0.6
                        })
                    );
                    atpMolecule.position.set(0, 0.8, 0.8);
                    atpMolecule.userData.type = 'atp_molecule';
                    subunit.add(atpMolecule);
                }
                
                f1Group.add(subunit);
            }
            
            // Central Stalk (Œ≥, Œ¥, Œµ subunitleri)
            const centralStalk = new THREE.Group();
            
            // Œ≥ subunit (Asimetrik d√∂nen ≈üaft)
            const gammaSubunit = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.4, 4, 6), // Asimetrik
                new THREE.MeshPhongMaterial({
                    color: 0xFFD700,
                    shininess: 80,
                    emissive: 0xFFA000,
                    emissiveIntensity: 0.3
                })
            );
            gammaSubunit.position.set(0, -1, 0);
            gammaSubunit.userData.rotating = true;
            centralStalk.add(gammaSubunit);
            
            // Œµ cap
            const epsilonCap = new THREE.Mesh(
                new THREE.SphereGeometry(0.5, 12, 8),
                new THREE.MeshPhongMaterial({
                    color: 0xFF7043,
                    emissive: 0xE64A19,
                    emissiveIntensity: 0.2
                })
            );
            epsilonCap.position.set(0, 0.8, 0);
            centralStalk.add(epsilonCap);
            
            f1Group.add(centralStalk);
            synthaseGroup.add(f1Group);
            
            // Peripheral Stalk (b, Œ¥ subunitleri)
            const peripheralStalk = new THREE.Mesh(
                new THREE.CylinderGeometry(0.15, 0.15, 3.5, 8),
                new THREE.MeshPhongMaterial({
                    color: 0x795548,
                    shininess: 40
                })
            );
            peripheralStalk.position.set(2.8, 1.2, 0);
            synthaseGroup.add(peripheralStalk);
            
            // F0 Motor (c-ring)
            const f0Group = new THREE.Group();
            f0Group.position.set(0, -0.3, 0);
            
            // c-ring (10-15 c subunitleri)
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2;
                const cSubunit = new THREE.Mesh(
                    new THREE.BoxGeometry(0.3, 1.2, 0.6),
                    new THREE.MeshPhongMaterial({
                        color: 0x8E24AA,
                        shininess: 50,
                        emissive: 0x6A1B9A,
                        emissiveIntensity: 0.1
                    })
                );
                cSubunit.position.set(
                    Math.cos(angle) * 1.8,
                    0,
                    Math.sin(angle) * 1.8
                );
                cSubunit.rotation.y = angle;
                f0Group.add(cSubunit);
            }
            
            // a/b stator subunitleri
            const statorA = new THREE.Mesh(
                new THREE.BoxGeometry(0.8, 1.5, 1.2),
                new THREE.MeshPhongMaterial({
                    color: 0x5D4037,
                    shininess: 30
                })
            );
            statorA.position.set(2.5, 0, 0);
            f0Group.add(statorA);
            
            f0Group.userData.rotating = true;
            synthaseGroup.add(f0Group);
            
            // Proton Kanal (a subunitinde)
            const protonChannel = new THREE.Mesh(
                new THREE.TorusGeometry(0.3, 0.1, 8, 16),
                new THREE.MeshBasicMaterial({
                    color: 0xFFEB3B,
                    transparent: true,
                    opacity: 0.8,
                    emissive: 0xFF8F00,
                    emissiveIntensity: 0.5
                })
            );
            protonChannel.position.set(2.5, 0, 0);
            protonChannel.rotation.x = Math.PI / 2;
            synthaseGroup.add(protonChannel);
            
            // Proton akƒ±≈ü yollarƒ±
            for (let i = 0; i < 8; i++) {
                const protonPath = new THREE.Mesh(
                    new THREE.SphereGeometry(0.1, 6, 6),
                    new THREE.MeshBasicMaterial({
                        color: 0xFFEB3B,
                        emissive: 0xFF6F00,
                        emissiveIntensity: 0.8
                    })
                );
                const angle = (i / 8) * Math.PI * 2;
                protonPath.position.set(
                    Math.cos(angle) * (2 + Math.sin(Date.now() * 0.01 + i) * 0.5),
                    Math.sin(Date.now() * 0.008 + i) * 0.3,
                    Math.sin(angle) * (2 + Math.sin(Date.now() * 0.01 + i) * 0.5)
                );
                protonPath.userData.type = 'proton';
                synthaseGroup.add(protonPath);
            }
            
            // Bilimsel etiket
            const label = createTextLabel('ATP Synthase Kompleksi\nF1: ATP Sentezi\nF0: Proton Motoru');
            label.position.set(5, 3, 0);
            label.scale.set(0.8, 0.8, 0.8);
            synthaseGroup.add(label);
            
            return synthaseGroup;
        }
        
        // Text label olu≈üturmak i√ßin basit bir fonksiyon
        function createTextLabel(text) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 256;
            
            context.fillStyle = 'rgba(255, 255, 255, 0.9)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            context.fillStyle = '#333';
            context.font = 'bold 32px Arial';
            context.textAlign = 'center';
            
            const lines = text.split('\n');
            lines.forEach((line, index) => {
                context.fillText(line, canvas.width / 2, 80 + (index * 40));
            });
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.MeshBasicMaterial({ 
                map: texture,
                transparent: true,
                side: THREE.DoubleSide
            });
            const geometry = new THREE.PlaneGeometry(4, 2);
            return new THREE.Mesh(geometry, material);
        }
        
        
        function createElectronTransportModel() {
            const etcGroup = new THREE.Group();
            etcGroup.userData.type = 'electron_transport';
            etcGroup.position.set(0, 0, 0);
            
            // Tilakoid Membranƒ± (ye≈üil tabaka)
            const membrane = new THREE.Mesh(
                new THREE.BoxGeometry(35, 1, 15),
                new THREE.MeshPhongMaterial({
                    color: 0x4CAF50,
                    shininess: 20,
                    transparent: true,
                    opacity: 0.6
                })
            );
            membrane.position.set(0, 0, 0);
            etcGroup.add(membrane);
            
            // 1. Fotosistem II (PSII) - I≈üƒ±ƒüƒ± yakalayan protein kompleksi
            const psiiGroup = new THREE.Group();
            psiiGroup.position.set(-12, 2, 0);
            
            // PSII ana yapƒ±sƒ± (mantar ≈üeklinde - ger√ßek yapƒ±ya benzer)
            const psiiStem = new THREE.Mesh(
                new THREE.CylinderGeometry(0.8, 1.2, 3, 16),
                new THREE.MeshPhongMaterial({
                    color: 0x2E7D32,
                    shininess: 50
                })
            );
            psiiGroup.add(psiiStem);
            
            // PSII tepesi (klorofil i√ßeren kƒ±sƒ±m)
            const psiiCap = new THREE.Mesh(
                new THREE.SphereGeometry(1.8, 16, 12),
                new THREE.MeshPhongMaterial({
                    color: 0x4CAF50,
                    shininess: 60,
                    emissive: 0x1B5E20,
                    emissiveIntensity: 0.1
                })
            );
            psiiCap.position.set(0, 1.8, 0);
            psiiGroup.add(psiiCap);
            
            // Klorofil molek√ºlleri (ye≈üil noktalar)
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2;
                const chlorophyll = new THREE.Mesh(
                    new THREE.SphereGeometry(0.1, 8, 6),
                    new THREE.MeshBasicMaterial({
                        color: 0x00E676,
                        emissive: 0x00C853,
                        emissiveIntensity: 0.5
                    })
                );
                chlorophyll.position.set(
                    Math.cos(angle) * 1.4,
                    1.8 + Math.sin(i * 0.3) * 0.3,
                    Math.sin(angle) * 1.4
                );
                psiiGroup.add(chlorophyll);
            }
            
            etcGroup.add(psiiGroup);
            
            // 2. Plastoquinone (PQ) - Elektron ta≈üƒ±yƒ±cƒ± molek√ºller
            const pqGroup = new THREE.Group();
            pqGroup.position.set(-6, 0, 0);
            
            // PQ molek√ºlleri (yassƒ± halka ≈üeklinde - ger√ßek yapƒ±ya benzer)
            for (let i = 0; i < 6; i++) {
                const pq = new THREE.Mesh(
                    new THREE.TorusGeometry(0.3, 0.1, 8, 16),
                    new THREE.MeshPhongMaterial({
                        color: 0xFFEB3B,
                        emissive: 0xFF8F00,
                        emissiveIntensity: 0.3
                    })
                );
                pq.position.set(
                    (Math.random() - 0.5) * 3,
                    (Math.random() - 0.5) * 2,
                    (Math.random() - 0.5) * 3
                );
                pq.rotation.x = Math.random() * Math.PI;
                pq.rotation.y = Math.random() * Math.PI;
                pq.userData.type = 'plastoquinone';
                pqGroup.add(pq);
            }
            
            etcGroup.add(pqGroup);
            
            // 3. Sitokrom b6f - Elektron transfer kompleksi
            const cytGroup = new THREE.Group();
            cytGroup.position.set(2, 2.5, 0);
            
            // Ana protein yapƒ±sƒ± (butterfly/kelebek ≈üeklinde)
            const cytLeft = new THREE.Mesh(
                new THREE.SphereGeometry(1.2, 12, 8, 0, Math.PI),
                new THREE.MeshPhongMaterial({
                    color: 0x8BC34A,
                    shininess: 50
                })
            );
            cytLeft.position.set(-0.5, 0, 0);
            cytGroup.add(cytLeft);
            
            const cytRight = new THREE.Mesh(
                new THREE.SphereGeometry(1.2, 12, 8, 0, Math.PI),
                new THREE.MeshPhongMaterial({
                    color: 0x8BC34A,
                    shininess: 50
                })
            );
            cytRight.position.set(0.5, 0, 0);
            cytRight.rotation.y = Math.PI;
            cytGroup.add(cytRight);
            
            // Demir i√ßeren heme gruplarƒ± (kƒ±rmƒ±zƒ± halkalar)
            for (let i = 0; i < 3; i++) {
                const heme = new THREE.Mesh(
                    new THREE.TorusGeometry(0.2, 0.05, 8, 16),
                    new THREE.MeshPhongMaterial({
                        color: 0xD32F2F,
                        emissive: 0xB71C1C,
                        emissiveIntensity: 0.4
                    })
                );
                heme.position.set(
                    (i - 1) * 0.4,
                    0,
                    0
                );
                cytGroup.add(heme);
            }
            
            etcGroup.add(cytGroup);
            
            // 4. Plastocyanin - Bakƒ±r i√ßeren ta≈üƒ±yƒ±cƒ± protein
            const pcGroup = new THREE.Group();
            pcGroup.position.set(8, 3, 0);
            
            // PC proteinleri (fasulye ≈üeklinde - ger√ßek yapƒ±ya benzer)
            for (let i = 0; i < 4; i++) {
                const pc = new THREE.Mesh(
                    new THREE.SphereGeometry(0.6, 12, 8),
                    new THREE.MeshPhongMaterial({
                        color: 0x00BCD4,
                        shininess: 60
                    })
                );
                pc.scale.set(1, 0.7, 1.3); // fasulye ≈üekli
                pc.position.set(
                    (Math.random() - 0.5) * 2,
                    (Math.random() - 0.5) * 1,
                    (Math.random() - 0.5) * 2
                );
                pc.rotation.x = Math.random() * Math.PI;
                pc.rotation.z = Math.random() * Math.PI;
                
                // Bakƒ±r atomu (mavi parlak nokta)
                const copper = new THREE.Mesh(
                    new THREE.SphereGeometry(0.1, 8, 6),
                    new THREE.MeshBasicMaterial({
                        color: 0xFF8A65,
                        emissive: 0xE64A19,
                        emissiveIntensity: 0.8
                    })
                );
                pc.add(copper);
                
                pcGroup.add(pc);
            }
            
            etcGroup.add(pcGroup);
            
            // 5. Fotosistem I (PSI) - ƒ∞kinci ƒ±≈üƒ±k yakalama sistemi
            const psiGroup = new THREE.Group();
            psiGroup.position.set(14, 2, 0);
            
            // PSI ana yapƒ±sƒ± (√ßi√ßek ≈üeklinde - ger√ßek yapƒ±ya benzer)
            const psiCenter = new THREE.Mesh(
                new THREE.CylinderGeometry(1, 1, 2, 8),
                new THREE.MeshPhongMaterial({
                    color: 0x2E7D32,
                    shininess: 60
                })
            );
            psiGroup.add(psiCenter);
            
            // PSI √ßi√ßek yapraklarƒ± (klorofil kompleksleri)
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const petal = new THREE.Mesh(
                    new THREE.SphereGeometry(0.4, 8, 6),
                    new THREE.MeshPhongMaterial({
                        color: 0x4CAF50,
                        emissive: 0x1B5E20,
                        emissiveIntensity: 0.2
                    })
                );
                petal.scale.set(1.5, 0.3, 0.8);
                petal.position.set(
                    Math.cos(angle) * 1.5,
                    0,
                    Math.sin(angle) * 1.5
                );
                petal.lookAt(psiCenter.position);
                psiGroup.add(petal);
            }
            
            // P700 reaksiyon merkezi
            const p700 = new THREE.Mesh(
                new THREE.SphereGeometry(0.2, 12, 8),
                new THREE.MeshBasicMaterial({
                    color: 0x00E676,
                    emissive: 0x00C853,
                    emissiveIntensity: 1
                })
            );
            p700.position.set(0, 1.2, 0);
            psiGroup.add(p700);
            
            etcGroup.add(psiGroup);
            
            // Elektron akƒ±≈ü yolu (Z-≈üemasƒ±)
            const electronPath = new THREE.BufferGeometry();
            const pathPoints = [
                new THREE.Vector3(-12, 3.5, 0),  // PSII'den
                new THREE.Vector3(-8, 2, 0),     // 
                new THREE.Vector3(-6, 1, 0),     // PQ'ya
                new THREE.Vector3(-2, 1.5, 0),   // 
                new THREE.Vector3(2, 3, 0),      // Cyt b6f'e
                new THREE.Vector3(5, 3.5, 0),    // 
                new THREE.Vector3(8, 3.5, 0),    // PC'ye
                new THREE.Vector3(11, 3, 0),     // 
                new THREE.Vector3(14, 2.5, 0)    // PSI'a
            ];
            
            electronPath.setFromPoints(pathPoints);
            const electronLine = new THREE.Line(
                electronPath,
                new THREE.LineBasicMaterial({
                    color: 0x00FFFF,
                    linewidth: 6,
                    transparent: true,
                    opacity: 0.9
                })
            );
            etcGroup.add(electronLine);
            
            // Elektron hareket animasyonu i√ßin partik√ºller
            for (let i = 0; i < 5; i++) {
                const electron = new THREE.Mesh(
                    new THREE.SphereGeometry(0.05, 8, 6),
                    new THREE.MeshBasicMaterial({
                        color: 0x00FFFF,
                        emissive: 0x006666,
                        emissiveIntensity: 1
                    })
                );
                electron.position.copy(pathPoints[Math.floor(i * pathPoints.length / 5)]);
                electron.userData.type = 'moving_electron';
                electron.userData.pathIndex = Math.floor(i * pathPoints.length / 5);
                etcGroup.add(electron);
            }
            
            // 10. sƒ±nƒ±f seviyesinde a√ßƒ±klamalar
            const labels = [
                {text: 'Fotosistem II\nI≈üƒ±ƒüƒ± yakalar\nSuyu par√ßalar\nH‚ÇÇO ‚Üí 2H‚Å∫ + ¬ΩO‚ÇÇ + 2e‚Åª', pos: [-12, 6, 0]},
                {text: 'Plastoquinone (PQ)\nElektron ta≈üƒ±r\nPQ + 2e‚Åª + 2H‚Å∫ ‚Üí PQH‚ÇÇ', pos: [-6, -2, 0]},
                {text: 'Sitokrom b6f\nElektron aktarƒ±r\nProton pompalar', pos: [2, 5.5, 0]},
                {text: 'Plastocyanin\nBakƒ±r ile\nelektron ta≈üƒ±r', pos: [8, 5.5, 0]},
                {text: 'Fotosistem I\nNADP‚Å∫ + 2e‚Åª + H‚Å∫ ‚Üí NADPH\nEnerji deposu yapar', pos: [14, 5, 0]}
            ];
            
            labels.forEach(labelInfo => {
                const label = createTextLabel(labelInfo.text);
                label.position.set(...labelInfo.pos);
                label.scale.set(0.5, 0.5, 0.5);
                etcGroup.add(label);
            });
            
            // Ana ba≈ülƒ±k ve genel denklem
            const titleLabel = createTextLabel('I≈üƒ±ƒüa Baƒüƒ±mlƒ± Tepkimeler - Elektron Ta≈üƒ±ma Zinciri\n\n2H‚ÇÇO + 2NADP‚Å∫ + 3ADP + 3Pi + ƒ±≈üƒ±k ‚Üí O‚ÇÇ + 2NADPH + 3ATP\n\n(Su + I≈üƒ±k = Oksijen + Enerji)');
            titleLabel.position.set(0, 8, 0);
            titleLabel.scale.set(0.8, 0.8, 0.8);
            etcGroup.add(titleLabel);
            
            return etcGroup;
        }
        
        // Detay modellerini kontrol etmek i√ßin fonksiyonlar
        function showDetailModel(modelName) {
            // T√ºm modelleri gizle
            Object.values(detailModels).forEach(model => {
                model.visible = false;
            });
            
            // Ana molek√ºl ve kloroplast sahnesini gizle/g√∂ster
            const mainMolecules = scene.children.filter(obj => 
                obj.userData.type === 'chloroplast' || 
                molecules.includes(obj) ||
                obj.userData.type === 'grana'
            );
            
            if (modelName && detailModels[modelName]) {
                // Detay modelini g√∂ster
                detailModels[modelName].visible = true;
                currentDetailModel = detailModels[modelName]; // Objeyi direkt set et
                
                // Ana sahneyi gizle
                mainMolecules.forEach(obj => {
                    obj.visible = false;
                });
                
                // Kamerayƒ± detay modeline odakla
                focusCameraOnModel(detailModels[modelName]);
                
                console.log(`üîç ${modelName} detay modeli g√∂steriliyor`);
            } else {
                // Ana sahneyi g√∂ster
                mainMolecules.forEach(obj => {
                    obj.visible = true;
                });
                
                currentDetailModel = null;
                
                // Kamerayƒ± ana konuma getir
                camera.position.set(0, 15, 25);
                controls.target.set(0, 0, 0);
                controls.update();
                
                console.log('üåç Ana sahne g√∂steriliyor');
            }
        }
        
        function focusCameraOnModel(model) {
            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            
            const maxDim = Math.max(size.x, size.y, size.z);
            const fov = camera.fov * (Math.PI / 180);
            const distance = maxDim / (2 * Math.tan(fov / 2));
            
            camera.position.copy(center.clone().add(new THREE.Vector3(0, 0, distance * 1.5)));
            controls.target.copy(center);
            controls.update();
        }
        
        function animateDetailModel(model) {
            if (!model || !model.userData) return;
            
            const modelType = model.userData.type;
            
            switch(modelType) {
                case 'atp_synthase':
                    animateATPSynthase(model);
                    break;
                case 'electron_transport':
                    animateElectronTransport(model);
                    break;
            }
        }
        
        function animateATPSynthase(synthase) {
            const time = Date.now() * 0.01;
            
            synthase.children.forEach(child => {
                // Merkezi d√∂nen ≈üaft (sarƒ±)
                if (child.userData.rotating) {
                    child.rotation.y += 0.05;
                }
                
                // F1 kafa (turuncu) - hafif titre≈üim
                if (child.userData.part === 'F1') {
                    const wobble = Math.sin(time) * 0.02;
                    child.position.y = 1 + wobble;
                }
                
                // ATP √ºretim siteleri (ye≈üil)
                if (child.userData.type === 'atp_binding_site') {
                    const intensity = 0.4 + Math.sin(time * 2 + child.position.x) * 0.3;
                    child.material.emissiveIntensity = intensity;
                }
                
                // F0 rotor (mor) - d√∂n√º≈ü
                if (child.material && child.material.color.getHex() === 0x9C27B0) {
                    child.rotation.y += 0.03;
                }
                
                // Proton akƒ±≈ü oklarƒ± (sarƒ±)
                if (child.userData.type === 'proton_flow') {
                    const intensity = 0.5 + Math.sin(time * 3 + child.position.x) * 0.4;
                    child.material.emissiveIntensity = intensity;
                    
                    // Oklarƒ±n hafif hareketi
                    const movement = Math.sin(time + child.position.x) * 0.1;
                    child.position.y = -1.5 + movement;
                }
            });
        }
        
        
        function animateElectronTransport(etc) {
            const time = Date.now() * 0.005;
            
            // Basit animasyonlar
            etc.children.forEach(child => {
                // PQ kutusu (sarƒ±)
                if (child.material && child.material.color.getHex() === 0xFFEB3B) {
                    child.rotation.y += 0.01;
                    const intensity = 0.2 + Math.sin(time) * 0.1;
                    child.material.emissiveIntensity = intensity;
                }
                
                // Cytochrome (ye≈üil)
                if (child.material && child.material.color.getHex() === 0x8BC34A) {
                    child.rotation.y += 0.005;
                }
                
                // Demir merkezi (kƒ±rmƒ±zƒ±)
                if (child.material && child.material.color.getHex() === 0xD32F2F) {
                    const intensity = 0.4 + Math.sin(time * 2) * 0.2;
                    child.material.emissiveIntensity = intensity;
                }
                
                // PC k√ºre (mavi)
                if (child.material && child.material.color.getHex() === 0x00BCD4) {
                    child.rotation.x += 0.01;
                }
                
                // Bakƒ±r merkezi (turuncu)
                if (child.material && child.material.color.getHex() === 0xFF8A65) {
                    const intensity = 0.5 + Math.sin(time * 3) * 0.3;
                    child.material.emissiveIntensity = intensity;
                }
                
                // Elektron akƒ±≈ü oklarƒ± (cyan)
                if (child.userData.type === 'electron_flow') {
                    const intensity = 0.6 + Math.sin(time * 4) * 0.4;
                    child.material.emissiveIntensity = intensity;
                }
            });
        }

        function createDetailedMolecule(data) {
            const group = new THREE.Group();
            const atoms = [];
            group.userData.moleculeName = data.name;
            group.userData.formula = data.formula;

            // Create atoms - detaylƒ± ve ger√ßek√ßi
            data.atoms.forEach((atomData, index) => {
                const element = atomData.element;
                const position = new THREE.Vector3(...atomData.position);
                
                // Ger√ßek√ßi atom geometrisi
                const atomGeometry = new THREE.SphereGeometry(atomSizes[element], 12, 10);
                const atomMaterial = new THREE.MeshPhongMaterial({
                    color: atomColors[element],
                    shininess: 60,
                    specular: 0x444444,
                    emissive: new THREE.Color(atomColors[element]).multiplyScalar(0.05)
                });
                
                const atom = new THREE.Mesh(atomGeometry, atomMaterial);
                atom.position.copy(position);
                atom.userData.element = element;
                atom.userData.atomIndex = index;
                
                // Atom etiketleri i√ßin k√º√ß√ºk glow efekti
                const glowGeometry = new THREE.SphereGeometry(atomSizes[element] * 1.1, 8, 6);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: atomColors[element],
                    transparent: true,
                    opacity: 0.15
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                glow.position.copy(position);
                
                group.add(atom);
                group.add(glow);
                atoms.push(atom);
            });

            // Create bonds - detaylƒ± baƒü sistemleri
            if (data.bonds) {
                data.bonds.forEach((bondData, bondIndex) => {
                    const atom1 = atoms[bondData.from];
                    const atom2 = atoms[bondData.to];
                    
                    if (!atom1 || !atom2) return;
                    
                    const distance = atom1.position.distanceTo(atom2.position);
                    const bondType = bondData.type || 'single';
                    
                    // Baƒü tipleri
                    if (bondType === 'single') {
                        createSingleBond(group, atom1.position, atom2.position, distance);
                    } else if (bondType === 'double') {
                        createDoubleBond(group, atom1.position, atom2.position, distance);
                    } else if (bondType === 'triple') {
                        createTripleBond(group, atom1.position, atom2.position, distance);
                    } else {
                        createSingleBond(group, atom1.position, atom2.position, distance);
                    }
                });
            }

            return group;
        }
        
        function createSingleBond(group, pos1, pos2, distance) {
            const bondGeometry = new THREE.CylinderGeometry(0.08, 0.08, distance, 8);
            const bondMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xdddddd,
                shininess: 30
            });
            
            const bond = new THREE.Mesh(bondGeometry, bondMaterial);
            orientBond(bond, pos1, pos2);
            group.add(bond);
        }
        
        function createDoubleBond(group, pos1, pos2, distance) {
            // √áift baƒü - paralel iki silindir
            for (let i = 0; i < 2; i++) {
                const bondGeometry = new THREE.CylinderGeometry(0.06, 0.06, distance, 8);
                const bondMaterial = new THREE.MeshPhongMaterial({ 
                    color: 0xdddddd,
                    shininess: 30
                });
                
                const bond = new THREE.Mesh(bondGeometry, bondMaterial);
                orientBond(bond, pos1, pos2);
                
                // Offset for parallel bonds
                const perpVector = new THREE.Vector3(0.15 * (i === 0 ? 1 : -1), 0, 0);
                bond.position.add(perpVector);
                
                group.add(bond);
            }
        }
        
        function createTripleBond(group, pos1, pos2, distance) {
            // √ú√ßl√º baƒü - √º√ß silindir
            for (let i = 0; i < 3; i++) {
                const bondGeometry = new THREE.CylinderGeometry(0.05, 0.05, distance, 6);
                const bondMaterial = new THREE.MeshPhongMaterial({ 
                    color: 0xdddddd,
                    shininess: 30
                });
                
                const bond = new THREE.Mesh(bondGeometry, bondMaterial);
                orientBond(bond, pos1, pos2);
                
                if (i > 0) {
                    const angle = (i - 1) * Math.PI;
                    const perpVector = new THREE.Vector3(
                        0.12 * Math.cos(angle),
                        0.12 * Math.sin(angle),
                        0
                    );
                    bond.position.add(perpVector);
                }
                
                group.add(bond);
            }
        }
        
        function orientBond(bond, pos1, pos2) {
            const midpoint = new THREE.Vector3().addVectors(pos1, pos2).multiplyScalar(0.5);
            bond.position.copy(midpoint);
            
            const direction = new THREE.Vector3().subVectors(pos2, pos1).normalize();
            const quaternion = new THREE.Quaternion().setFromUnitVectors(
                new THREE.Vector3(0, 1, 0), 
                direction
            );
            bond.setRotationFromQuaternion(quaternion);
        }

        function createRealisticChloroplast() {
            try {
                console.log('üå± Ger√ßek√ßi kloroplast olu≈üturuluyor...');
                
                // 1. Dƒ±≈ü Zar (Outer Membrane)
                const outerMembraneGeom = new THREE.SphereGeometry(12, 32, 24);
                outerMembraneGeom.scale(1.6, 0.9, 1.1);
                const outerMembraneMaterial = new THREE.MeshPhongMaterial({
                    color: 0x1B5E20,
                    transparent: true,
                    opacity: 0.3,
                    side: THREE.DoubleSide
                });
                const outerMembrane = new THREE.Mesh(outerMembraneGeom, outerMembraneMaterial);
                scene.add(outerMembrane);
                
                // 2. ƒ∞√ß Zar (Inner Membrane) 
                const innerMembraneGeom = new THREE.SphereGeometry(11.5, 32, 24);
                innerMembraneGeom.scale(1.5, 0.85, 1.05);
                const innerMembraneMaterial = new THREE.MeshPhongMaterial({
                    color: 0x2E7D32,
                    transparent: true,
                    opacity: 0.4,
                    side: THREE.DoubleSide
                });
                const innerMembrane = new THREE.Mesh(innerMembraneGeom, innerMembraneMaterial);
                scene.add(innerMembrane);
                
                // 3. Stroma (ƒ∞√ß Ortam)
                const stromaGeometry = new THREE.SphereGeometry(11, 24, 20);
                stromaGeometry.scale(1.4, 0.8, 1.0);
                const stromaMaterial = new THREE.MeshPhongMaterial({
                    color: 0x388E3C,
                    transparent: true,
                    opacity: 0.6,
                    emissive: 0x1B5E20,
                    emissiveIntensity: 0.1
                });
                chloroplast = new THREE.Mesh(stromaGeometry, stromaMaterial);
                chloroplast.userData.type = 'chloroplast';
                scene.add(chloroplast);
                
                // 4. Grana (Tilakoid Yƒ±ƒüƒ±nlarƒ±)
                createGranaStacks();
                
                // 5. Stroma Lamellarƒ±
                createStromaLamellae();
                
                console.log('‚úÖ Ger√ßek√ßi kloroplast olu≈üturuldu');
                
            } catch (error) {
                console.error('Kloroplast olu≈üturma hatasƒ±:', error);
            }
        }
        
        function createGranaStacks() {
            // 6-8 adet grana yƒ±ƒüƒ±nƒ± olu≈ütur
            for (let i = 0; i < 7; i++) {
                const granaGroup = new THREE.Group();
                granaGroup.userData.type = 'grana';
                
                // Her grana'da 8-12 tilakoid
                const thylakoidCount = 8 + Math.floor(Math.random() * 4);
                for (let j = 0; j < thylakoidCount; j++) {
                    const thylakoidGeom = new THREE.CylinderGeometry(1.8, 1.8, 0.15, 16);
                    const thylakoidMaterial = new THREE.MeshPhongMaterial({
                        color: 0x4CAF50,
                        shininess: 60,
                        emissive: 0x2E7D32,
                        emissiveIntensity: 0.2
                    });
                    
                    const thylakoid = new THREE.Mesh(thylakoidGeom, thylakoidMaterial);
                    thylakoid.position.y = j * 0.2 - (thylakoidCount * 0.1);
                    thylakoid.userData.type = 'thylakoid';
                    thylakoid.userData.granaIndex = i;
                    granaGroup.add(thylakoid);
                }
                
                // Grana pozisyonlarƒ± - kloroplast i√ßinde daƒüƒ±tƒ±lmƒ±≈ü
                granaGroup.position.set(
                    (Math.random() - 0.5) * 16,
                    (Math.random() - 0.5) * 8,
                    (Math.random() - 0.5) * 12
                );
                granaGroup.rotation.set(
                    Math.random() * Math.PI * 0.3,
                    Math.random() * Math.PI * 2,
                    Math.random() * Math.PI * 0.3
                );
                
                scene.add(granaGroup);
            }
        }
        
        function createStromaLamellae() {
            // Stroma lamellarƒ± - grana'larƒ± baƒülayan yapƒ±lar
            for (let i = 0; i < 5; i++) {
                const lamellaGeom = new THREE.CylinderGeometry(0.8, 0.8, 0.1, 12);
                const lamellaMaterial = new THREE.MeshPhongMaterial({
                    color: 0x66BB6A,
                    transparent: true,
                    opacity: 0.7
                });
                
                const lamella = new THREE.Mesh(lamellaGeom, lamellaMaterial);
                lamella.position.set(
                    (Math.random() - 0.5) * 18,
                    (Math.random() - 0.5) * 6,
                    (Math.random() - 0.5) * 10
                );
                lamella.rotation.x = Math.random() * Math.PI;
                lamella.rotation.z = Math.random() * Math.PI;
                lamella.userData.type = 'stroma_lamella';
                
                scene.add(lamella);
            }
        }

        function setupEventListeners() {
            // Control buttons
            document.getElementById('playBtn').addEventListener('click', startAnimation);
            document.getElementById('pauseBtn').addEventListener('click', pauseAnimation);
            document.getElementById('resetBtn').addEventListener('click', resetAnimation);
            document.getElementById('phaseBtn').addEventListener('click', nextPhase);
            document.getElementById('cameraBtn').addEventListener('click', switchCamera);
            document.getElementById('moleculeBtn').addEventListener('click', toggleMoleculeDetail);

            // Mouse interaction
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('click', onMouseClick);
            
            // Window resize
            window.addEventListener('resize', onWindowResize);
        }

        function startAnimation() {
            isAnimating = true;
            document.getElementById('playBtn').classList.add('active');
            document.getElementById('pauseBtn').classList.remove('active');
            
            startPhaseAnimation();
        }

        function pauseAnimation() {
            isAnimating = false;
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('pauseBtn').classList.add('active');
        }

        function resetAnimation() {
            isAnimating = false;
            currentPhase = 0;
            
            // Reset molecule positions
            molecules.forEach(molecule => {
                molecule.position.copy(molecule.userData.originalPosition);
                molecule.rotation.set(0, 0, 0);
            });

            // Clear particles
            photons.forEach(photon => scene.remove(photon));
            electrons.forEach(electron => scene.remove(electron));
            photons = [];
            electrons = [];

            // Reset UI
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('pauseBtn').classList.remove('active');
            hidePhaseExplanation();
            
            updatePhaseInfo();
            updatePhaseExplanation();
            updatePhaseEquation();
        }

        function nextPhase() {
            currentPhase = (currentPhase + 1) % phases.length;
            updatePhaseInfo();
            updatePhaseExplanation();
            updatePhaseEquation();
            
            if (isAnimating) {
                startPhaseAnimation();
            }
        }

        function togglePhaseExplanation() {
            const panel = document.getElementById('phaseExplanation');
            if (panel.classList.contains('show')) {
                hidePhaseExplanation();
            } else {
                showPhaseExplanation();
            }
        }

        function showPhaseExplanation() {
            updatePhaseExplanation();
            document.getElementById('phaseExplanation').classList.add('show');
        }

        function hidePhaseExplanation() {
            document.getElementById('phaseExplanation').classList.remove('show');
        }

        function updatePhaseExplanation() {
            const explanation = phaseExplanations[currentPhase];
            if (explanation) {
                document.getElementById('explanationTitle').innerHTML = 
                    `${explanation.icon} <span>${explanation.title}</span>`;
                document.getElementById('explanationDescription').textContent = explanation.description;
                document.getElementById('explanationProcess').innerHTML = 
                    `<strong>Bu Fazda Neler Oluyor:</strong><br>${explanation.process.replace(/\n/g, '<br>')}`;
                
                const moleculesContainer = document.getElementById('explanationMolecules');
                moleculesContainer.innerHTML = '';
                explanation.molecules.forEach(molecule => {
                    const badge = document.createElement('span');
                    badge.className = 'molecule-badge';
                    badge.style.background = `linear-gradient(45deg, ${molecule.color}, ${molecule.color}aa)`;
                    badge.textContent = molecule.name;
                    moleculesContainer.appendChild(badge);
                });
            }
        }

        function updatePhaseEquation() {
            const equation = phaseEquations[currentPhase];
            if (equation) {
                document.getElementById('equationTitle').textContent = equation.title;
                
                const formulaContainer = document.getElementById('equationFormula');
                formulaContainer.innerHTML = '';
                
                equation.formula.forEach(part => {
                    const span = document.createElement('span');
                    
                    if (part.type === 'arrow') {
                        span.className = 'equation-arrow';
                    } else if (part.type === 'operator') {
                        span.style.margin = '0 8px';
                        span.style.color = '#666';
                    } else {
                        span.className = `molecule-part ${part.type}`;
                    }
                    
                    span.textContent = part.text;
                    formulaContainer.appendChild(span);
                });
            }
        }

        function showVisualHint(message, x, y) {
            const hint = document.getElementById('visualHint');
            hint.textContent = message;
            hint.style.left = x + 'px';
            hint.style.top = y + 'px';
            hint.style.display = 'block';
            
            setTimeout(() => {
                hint.style.display = 'none';
            }, 3000);
        }



        function switchCamera() {
            cameraAngle = (cameraAngle + 1) % 4;
            
            const animations = [
                { position: [0, 15, 25], target: [0, 0, 0] },      // Default
                { position: [0, 40, 0], target: [0, 0, 0] },       // Top view
                { position: [35, 15, 0], target: [0, 0, 0] },      // Side view
                { position: [5, 8, 12], target: [0, 0, 0] }        // Close-up
            ];
            
            const targetAnimation = animations[cameraAngle];
            animateCameraTo(targetAnimation.position, targetAnimation.target);
        }

        function animateCameraTo(targetPosition, targetLookAt) {
            const startPosition = camera.position.clone();
            const endPosition = new THREE.Vector3(...targetPosition);
            let progress = 0;
            
            const animateCamera = () => {
                progress += 0.02;
                if (progress >= 1) {
                    camera.position.copy(endPosition);
                    controls.target.set(...targetLookAt);
                    controls.update();
                    return;
                }
                
                camera.position.lerpVectors(startPosition, endPosition, progress);
                controls.target.lerp(new THREE.Vector3(...targetLookAt), progress);
                controls.update();
                
                requestAnimationFrame(animateCamera);
            };
            
            animateCamera();
        }

        function toggleMoleculeDetail() {
            const detailPanel = document.getElementById('molecule-detail');
            if (selectedMolecule) {
                detailPanel.style.display = detailPanel.style.display === 'none' ? 'block' : 'none';
            } else {
                alert('L√ºtfen √∂nce bir molek√ºl se√ßin!');
            }
        }

        function updateMoleculeDetail(molecule) {
            const data = molecule.userData.data;
            const detailPanel = document.getElementById('molecule-detail');
            
            document.getElementById('detail-title').textContent = data.name;
            document.getElementById('detail-formula').textContent = data.formula;
            document.getElementById('detail-description').textContent = data.description;
            
            const atomCounts = {};
            data.atoms.forEach(atom => {
                atomCounts[atom.element] = (atomCounts[atom.element] || 0) + 1;
            });
            
            document.getElementById('detail-atoms').innerHTML = 
                Object.entries(atomCounts)
                    .map(([element, count]) => `<span style="color: #${atomColors[element].toString(16).padStart(6, '0')};">${element}: ${count}</span>`)
                    .join(', ');
            
            detailPanel.style.display = 'block';
        }

        function startPhaseAnimation() {
            if (!isAnimating) return;
            
            // Show visual hint for current phase
            const explanation = phaseExplanations[currentPhase];
            if (explanation) {
                setTimeout(() => {
                    showVisualHint(explanation.hint, window.innerWidth / 2, 100);
                }, 1000);
            }
            
            switch(currentPhase) {
                case 0: startLightDependentPhase(); break;
                case 1: startLightIndependentPhase(); break;
            }
        }


        let moleculePool = {
            atp: [],
            nadph: [],
            oxygen: [],
            maxMolecules: 15 // Maksimum molek√ºl sayƒ±sƒ±
        };
        
        function startLightDependentPhase() {
            if (!isAnimating) return;
            
            console.log('‚òÄÔ∏è I≈üƒ±ƒüa baƒülƒ± evre ba≈üladƒ±');
            
            // 1. I≈üƒ±k fotonlarƒ±nƒ± g√∂nder
            createPhotonStream();
            
            // 2. Klorofil aktivasyonu
            setTimeout(() => {
                if (isAnimating) activateChlorophyll();
            }, 500);
            
            // 3. Su par√ßalanmasƒ± (Photolysis)
            setTimeout(() => {
                if (isAnimating) simulateWaterPhotolysis();
            }, 1000);
            
            // 4. Elektron ta≈üƒ±ma zinciri
            setTimeout(() => {
                if (isAnimating) startElectronTransport();
            }, 1500);
            
            // 5. ATP ve NADPH sentezi
            setTimeout(() => {
                if (isAnimating) synthesizeEnergyMolecules();
            }, 2000);
            
            // Faz d√∂ng√ºs√º
            setTimeout(() => {
                if (isAnimating) startLightDependentPhase();
            }, 6000);
        }
        
        function createPhotonStream() {
            // Kontroll√º foton √ºretimi
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    if (isAnimating && photons.length < 8) { // Maksimum 8 foton
                        createPhoton(0xFFD700);
                    }
                }, i * 300);
            }
        }
        
        function activateChlorophyll() {
            // Klorofil molek√ºllerini uyar
            const chlorophylls = molecules.filter(m => m.userData.type === 'chlorophyll');
            const randomChlorophyll = chlorophylls[Math.floor(Math.random() * chlorophylls.length)];
            
            if (randomChlorophyll && randomChlorophyll.userData.state === 'ground') {
                // Uyarƒ±lmƒ±≈ü duruma ge√ß
                randomChlorophyll.userData.state = 'excited';
                
                // Renk deƒüi≈üimi ile g√∂rsel feedback
                randomChlorophyll.children.forEach(child => {
                    if (child.material) {
                        child.material.emissive.setHex(0x88FF88);
                        child.material.emissiveIntensity = 0.3;
                    }
                });
                
                // 2 saniye sonra normale d√∂n
                setTimeout(() => {
                    randomChlorophyll.userData.state = 'ground';
                    randomChlorophyll.children.forEach(child => {
                        if (child.material) {
                            child.material.emissive.setHex(0x1B5E20);
                            child.material.emissiveIntensity = 0.05;
                        }
                    });
                }, 2000);
                
                console.log('üå± Klorofil aktive oldu');
            }
        }
        
        function simulateWaterPhotolysis() {
            // Su molek√ºl√ºn√º par√ßala
            const waterMolecules = molecules.filter(m => 
                m.userData.type === 'water' && 
                m.userData.state === 'stable' && 
                m.userData.canSplit
            );
            
            if (waterMolecules.length > 0) {
                const water = waterMolecules[0];
                
                // Par√ßalanma animasyonu
                water.userData.state = 'splitting';
                water.userData.canSplit = false;
                
                // Su molek√ºl√ºn√º titret
                const originalScale = water.scale.clone();
                const shakeTween = {
                    shake: () => {
                        water.scale.set(
                            originalScale.x * (1 + (Math.random() - 0.5) * 0.2),
                            originalScale.y * (1 + (Math.random() - 0.5) * 0.2),
                            originalScale.z * (1 + (Math.random() - 0.5) * 0.2)
                        );
                    }
                };
                
                let shakeCount = 0;
                const shakeInterval = setInterval(() => {
                    shakeTween.shake();
                    shakeCount++;
                    if (shakeCount > 10) {
                        clearInterval(shakeInterval);
                        water.scale.copy(originalScale);
                        
                        // Oksijen √ºret
                        createOxygenFromWater(water.position);
                        
                        // Proton ve elektron sal
                        createProtons(water.position, 4);
                        createElectrons(water.position, 2);
                    }
                }, 100);
                
                console.log('üíß Su molek√ºl√º par√ßalandƒ± - O2, H+, e- √ºretildi');
            }
        }
        
        function createOxygenFromWater(position) {
            // Oksijen havaciklarƒ± √ºret
            if (moleculePool.oxygen.length < moleculePool.maxMolecules) {
                try {
                    const oxygen = createDetailedMolecule(moleculeData.oxygen);
                    oxygen.position.copy(position.clone().add(new THREE.Vector3(2, 1, 0)));
                    oxygen.scale.set(0.8, 0.8, 0.8);
                    oxygen.userData = {
                        type: 'oxygen',
                        data: moleculeData.oxygen,
                        id: `oxygen_${Date.now()}`,
                        state: 'rising',
                        velocity: new THREE.Vector3(0, 0.3, 0),
                        life: 300
                    };
                    
                    scene.add(oxygen);
                    moleculePool.oxygen.push(oxygen);
                    
                    // Renk efekti
                    oxygen.children.forEach(child => {
                        if (child.material) {
                            child.material.emissive.setHex(0x00FF88);
                            child.material.emissiveIntensity = 0.2;
                        }
                    });
                    
                } catch (error) {
                    console.warn('Oksijen √ºretimi hatasƒ±:', error);
                }
            }
        }
        
        function createProtons(position, count) {
            // Proton par√ßacƒ±klarƒ± √ºret
            for (let i = 0; i < count; i++) {
                const protonGeom = new THREE.SphereGeometry(0.15, 8, 6);
                const protonMaterial = new THREE.MeshBasicMaterial({
                    color: 0xFFEB3B,
                    emissive: 0xFF8F00,
                    emissiveIntensity: 0.5
                });
                
                const proton = new THREE.Mesh(protonGeom, protonMaterial);
                proton.position.copy(position.clone().add(new THREE.Vector3(
                    (Math.random() - 0.5) * 2,
                    Math.random() * 2,
                    (Math.random() - 0.5) * 2
                )));
                
                proton.userData = {
                    type: 'proton',
                    velocity: new THREE.Vector3(
                        (Math.random() - 0.5) * 0.2,
                        0.1,
                        (Math.random() - 0.5) * 0.2
                    ),
                    life: 100
                };
                
                scene.add(proton);
                electrons.push(proton); // Aynƒ± array'i kullanƒ±yoruz - lifecycle i√ßin
            }
        }
        
        function createElectrons(position, count) {
            // Elektron par√ßacƒ±klarƒ± √ºret
            for (let i = 0; i < count; i++) {
                const electronGeom = new THREE.SphereGeometry(0.1, 6, 5);
                const electronMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00FFFF,
                    emissive: 0x006666,
                    emissiveIntensity: 0.8
                });
                
                const electron = new THREE.Mesh(electronGeom, electronMaterial);
                electron.position.copy(position.clone());
                
                electron.userData = {
                    type: 'electron',
                    angle: Math.random() * Math.PI * 2,
                    radius: 3 + Math.random() * 2,
                    speed: 0.2 + Math.random() * 0.1,
                    center: position.clone(),
                    life: 150
                };
                
                scene.add(electron);
                electrons.push(electron);
            }
        }
        
        function startElectronTransport() {
            // Elektron ta≈üƒ±ma zinciri sim√ºlasyonu
            const electrons = scene.children.filter(obj => obj.userData.type === 'electron');
            
            electrons.forEach(electron => {
                // Elektron enerjisini artƒ±r
                if (electron.material) {
                    electron.material.emissiveIntensity = 1.0;
                }
            });
            
            console.log('‚ö° Elektron ta≈üƒ±ma zinciri aktif');
        }
        
        function synthesizeEnergyMolecules() {
            // ATP sentezi
            if (moleculePool.atp.length < moleculePool.maxMolecules && Math.random() > 0.3) {
                createATPMolecule();
            }
            
            // NADPH sentezi
            if (moleculePool.nadph.length < moleculePool.maxMolecules && Math.random() > 0.5) {
                createNADPHMolecule();
            }
        }
        
        function createATPMolecule() {
            try {
                const atp = createDetailedMolecule(moleculeData.atp);
                atp.position.set(
                    (Math.random() - 0.5) * 20,
                    (Math.random() - 0.5) * 10,
                    (Math.random() - 0.5) * 15
                );
                atp.scale.set(0.4, 0.4, 0.4);
                atp.userData = {
                    type: 'atp',
                    data: moleculeData.atp,
                    id: `atp_${Date.now()}`,
                    state: 'active',
                    energy: 100,
                    life: 400
                };
                
                scene.add(atp);
                moleculePool.atp.push(atp);
                
                // ATP g√∂rsel efekti
                atp.children.forEach(child => {
                    if (child.material && child.userData.element === 'P') {
                        child.material.emissive.setHex(0x00FF00);
                        child.material.emissiveIntensity = 0.4;
                    }
                });
                
                console.log('‚ö° ATP sentezlendi');
                
            } catch (error) {
                console.warn('ATP sentez hatasƒ±:', error);
            }
        }
        
        function createNADPHMolecule() {
            try {
                const nadph = createDetailedMolecule(moleculeData.nadph);
                nadph.position.set(
                    (Math.random() - 0.5) * 18,
                    (Math.random() - 0.5) * 8,
                    (Math.random() - 0.5) * 12
                );
                nadph.scale.set(0.5, 0.5, 0.5);
                nadph.userData = {
                    type: 'nadph',
                    data: moleculeData.nadph,
                    id: `nadph_${Date.now()}`,
                    state: 'reduced',
                    energy: 150,
                    life: 350
                };
                
                scene.add(nadph);
                moleculePool.nadph.push(nadph);
                
                // NADPH g√∂rsel efekti
                nadph.children.forEach(child => {
                    if (child.material) {
                        child.material.emissive.setHex(0x9C27B0);
                        child.material.emissiveIntensity = 0.3;
                    }
                });
                
                console.log('üß¨ NADPH sentezlendi');
                
            } catch (error) {
                console.warn('NADPH sentez hatasƒ±:', error);
            }
        }
        
        function animateWaterSplitting(water) {
            // Su molek√ºl√º hi√ß b√ºy√ºmez - sadece oksijen √ºretir
            // Oksijen kabarcaƒüƒ± olu≈ütur
            createOxygenBubble(water.position);
        }

        function startLightIndependentPhase() {
            if (!isAnimating) return;
            
            console.log('üåø Calvin d√∂ng√ºs√º ba≈üladƒ±');
            
            // 1. CO2 Fiksasyonu
            setTimeout(() => {
                if (isAnimating) simulateCO2Fixation();
            }, 500);
            
            // 2. ATP ve NADPH t√ºketimi
            setTimeout(() => {
                if (isAnimating) consumeEnergyMolecules();
            }, 1500);
            
            // 3. Glukoz sentezi
            setTimeout(() => {
                if (isAnimating) synthesizeGlucose();
            }, 2500);
            
            // 4. RuBP rejenerasyonu
            setTimeout(() => {
                if (isAnimating) regenerateRuBP();
            }, 3500);
            
            // D√∂ng√º devamƒ±
            setTimeout(() => {
                if (isAnimating) startLightIndependentPhase();
            }, 5000);
        }
        
        function simulateCO2Fixation() {
            // CO2 molek√ºl√ºlerini RuBP ile birle≈ütir
            const co2Molecules = molecules.filter(m => 
                m.userData.type === 'co2' && 
                m.userData.state === 'free' && 
                m.userData.canBeFixed
            );
            
            if (co2Molecules.length > 0) {
                const co2 = co2Molecules[0];
                
                // Fiksasyon animasyonu
                co2.userData.state = 'fixing';
                co2.userData.canBeFixed = false;
                
                // RuBisCO enzim efekti (g√∂rsel)
                const enzymeEffect = new THREE.Mesh(
                    new THREE.SphereGeometry(2, 12, 8),
                    new THREE.MeshBasicMaterial({
                        color: 0x8BC34A,
                        transparent: true,
                        opacity: 0.4,
                        emissive: 0x4CAF50,
                        emissiveIntensity: 0.3
                    })
                );
                
                enzymeEffect.position.copy(co2.position);
                scene.add(enzymeEffect);
                
                // 1 saniye sonra enzim efektini kaldƒ±r
                setTimeout(() => {
                    scene.remove(enzymeEffect);
                    
                    // CO2'yi PGA'ya d√∂n√º≈üt√ºr (g√∂rsel olarak)
                    co2.children.forEach(child => {
                        if (child.material) {
                            child.material.color.setHex(0x4CAF50);
                            child.material.emissive.setHex(0x2E7D32);
                        }
                    });
                    
                    co2.userData.type = 'pga'; // 3-Phosphoglyceric acid
                    co2.userData.state = 'fixed';
                    
                }, 1000);
                
                console.log('üå± CO2 fiksasyonu - RuBisCO aktif');
            }
        }
        
        function consumeEnergyMolecules() {
            // ATP t√ºketimi
            if (moleculePool.atp.length > 0) {
                const atp = moleculePool.atp.shift();
                
                // T√ºketim animasyonu
                atp.children.forEach(child => {
                    if (child.material) {
                        child.material.color.setHex(0x666666);
                        child.material.emissive.setHex(0x222222);
                    }
                });
                
                // ATP -> ADP d√∂n√º≈ü√ºm√º
                setTimeout(() => {
                    scene.remove(atp);
                    
                    // ADP olu≈ütur (basit g√∂rsel)
                    const adpGeom = new THREE.SphereGeometry(0.3, 8, 6);
                    const adpMaterial = new THREE.MeshBasicMaterial({
                        color: 0xFF5722,
                        emissive: 0xBF360C,
                        emissiveIntensity: 0.2
                    });
                    const adp = new THREE.Mesh(adpGeom, adpMaterial);
                    adp.position.copy(atp.position);
                    adp.userData = {
                        type: 'adp',
                        life: 200
                    };
                    
                    scene.add(adp);
                    electrons.push(adp);
                    
                }, 500);
                
                console.log('‚ö° ATP t√ºketildi -> ADP + Pi');
            }
            
            // NADPH t√ºketimi
            if (moleculePool.nadph.length > 0) {
                const nadph = moleculePool.nadph.shift();
                
                nadph.children.forEach(child => {
                    if (child.material) {
                        child.material.emissive.setHex(0x444444);
                        child.material.emissiveIntensity = 0.1;
                    }
                });
                
                setTimeout(() => {
                    scene.remove(nadph);
                }, 800);
                
                console.log('üß¨ NADPH t√ºketildi -> NADP+');
            }
        }
        
        function synthesizeGlucose() {
            // Glukoz molek√ºl√º sentezle
            if (moleculePool.atp.length >= 1 && Math.random() > 0.4) {
                try {
                    const glucose = createDetailedMolecule(moleculeData.glucose);
                    glucose.position.set(
                        (Math.random() - 0.5) * 15,
                        -10 + Math.random() * 5,
                        (Math.random() - 0.5) * 12
                    );
                    glucose.scale.set(0.6, 0.6, 0.6);
                    glucose.userData = {
                        type: 'glucose',
                        data: moleculeData.glucose,
                        id: `glucose_${Date.now()}`,
                        state: 'synthesized',
                        life: 500
                    };
                    
                    scene.add(glucose);
                    molecules.push(glucose);
                    
                    // Glukoz g√∂rsel efekti
                    glucose.children.forEach(child => {
                        if (child.material) {
                            child.material.color.setHex(0xFFC107);
                            child.material.emissive.setHex(0xFF8F00);
                            child.material.emissiveIntensity = 0.4;
                        }
                    });
                    
                    console.log('üçØ Glukoz sentezlendi!');
                    
                } catch (error) {
                    console.warn('Glukoz sentez hatasƒ±:', error);
                }
            }
        }
        
        function regenerateRuBP() {
            // RuBP rejenerasyonu sim√ºlasyonu
            console.log('üîÑ RuBP rejenerasyonu tamamlandƒ±');
            
            // Yeni CO2 fiksasyon kapasitesi
            const co2Molecules = molecules.filter(m => m.userData.type === 'co2');
            co2Molecules.forEach(co2 => {
                if (co2.userData.state === 'fixing') {
                    co2.userData.state = 'free';
                    co2.userData.canBeFixed = true;
                }
            });
        }
        
        // Molek√ºl lifecycle y√∂netimi
        function manageMoleculeLifecycle() {
            // ATP lifecycle
            moleculePool.atp = moleculePool.atp.filter(atp => {
                atp.userData.life--;
                if (atp.userData.life <= 0) {
                    scene.remove(atp);
                    return false;
                }
                return true;
            });
            
            // NADPH lifecycle
            moleculePool.nadph = moleculePool.nadph.filter(nadph => {
                nadph.userData.life--;
                if (nadph.userData.life <= 0) {
                    scene.remove(nadph);
                    return false;
                }
                return true;
            });
            
            // Oksijen lifecycle - yukarƒ± hareket
            moleculePool.oxygen = moleculePool.oxygen.filter(oxygen => {
                oxygen.position.add(oxygen.userData.velocity);
                oxygen.userData.life--;
                
                if (oxygen.userData.life <= 0 || oxygen.position.y > 30) {
                    scene.remove(oxygen);
                    return false;
                }
                return true;
            });
            
            // Glukoz lifecycle
            molecules = molecules.filter(molecule => {
                if (molecule.userData.life !== undefined) {
                    molecule.userData.life--;
                    if (molecule.userData.life <= 0) {
                        scene.remove(molecule);
                        return false;
                    }
                }
                return true;
            });
        }


        function startCalvinCycle() {
            const co2Molecules = molecules.filter(m => m.userData.type === 'co2');
            const glucoseMolecules = molecules.filter(m => m.userData.type === 'glucose');
            
            co2Molecules.forEach((co2, index) => {
                setTimeout(() => {
                    if (isAnimating && glucoseMolecules[0]) {
                        // Move CO2 towards glucose
                        const targetPos = glucoseMolecules[0].position.clone();
                        const startPos = co2.position.clone();
                        
                        let progress = 0;
                        const moveInterval = setInterval(() => {
                            progress += 0.03;
                            if (progress >= 1) {
                                clearInterval(moveInterval);
                                energyLevel += 20;
                                return;
                            }
                            co2.position.lerpVectors(startPos, targetPos, progress);
                        }, 16);
                    }
                }, index * 1200);
            });
            
            setTimeout(() => {
                if (isAnimating) startCalvinCycle();
            }, 5000);
        }

        function createPhoton(color = 0xffff00) {
            const photonGeometry = new THREE.SphereGeometry(0.3, 12, 12);
            const photonMaterial = new THREE.MeshBasicMaterial({
                color: color,
                emissive: color,
                emissiveIntensity: 0.8
            });

            const photon = new THREE.Mesh(photonGeometry, photonMaterial);
            photon.position.set(
                (Math.random() - 0.5) * 30,
                30,
                (Math.random() - 0.5) * 30
            );
            
            // Add glow effect
            const glowGeometry = new THREE.SphereGeometry(0.6, 8, 8);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: color,
                transparent: true,
                opacity: 0.3
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            photon.add(glow);
            
            photon.userData = {
                velocity: new THREE.Vector3(0, -0.8, 0),
                life: 120,
                type: 'photon'
            };

            scene.add(photon);
            photons.push(photon);
        }
        
        function createOxygenBubble(position) {
            const bubbleGeometry = new THREE.SphereGeometry(0.4, 8, 8);
            const bubbleMaterial = new THREE.MeshBasicMaterial({
                color: 0x00FF88,
                transparent: true,
                opacity: 0.7
            });
            
            const bubble = new THREE.Mesh(bubbleGeometry, bubbleMaterial);
            bubble.position.copy(position);
            
            bubble.userData = {
                velocity: new THREE.Vector3(0, 0.5, 0),
                life: 100,
                type: 'oxygen'
            };
            
            scene.add(bubble);
            photons.push(bubble); // Using same array for simplicity
        }
        
        function createPlastoquinone() {
            const pqGeometry = new THREE.BoxGeometry(0.3, 0.3, 0.3);
            const pqMaterial = new THREE.MeshBasicMaterial({
                color: 0x4CAF50,
                emissive: 0x2E7D32
            });
            
            const pq = new THREE.Mesh(pqGeometry, pqMaterial);
            pq.position.set(5, 0, 0);
            
            pq.userData = {
                velocity: new THREE.Vector3(-0.3, 0, 0),
                life: 80,
                type: 'plastoquinone'
            };
            
            scene.add(pq);
            electrons.push(pq);
        }
        
        function createProtonGradient() {
            for (let i = 0; i < 6; i++) {
                const protonGeometry = new THREE.SphereGeometry(0.1, 6, 6);
                const protonMaterial = new THREE.MeshBasicMaterial({
                    color: 0xFFC107,
                    emissive: 0xFF8F00
                });
                
                const proton = new THREE.Mesh(protonGeometry, protonMaterial);
                proton.position.set(
                    (Math.random() - 0.5) * 20,
                    Math.random() * 10 + 5,
                    (Math.random() - 0.5) * 20
                );
                
                proton.userData = {
                    velocity: new THREE.Vector3(0, -0.2, 0),
                    life: 60,
                    type: 'proton'
                };
                
                scene.add(proton);
                electrons.push(proton);
            }
        }
        
        function createNADPH() {
            const nadphGeometry = new THREE.OctahedronGeometry(0.4, 0);
            const nadphMaterial = new THREE.MeshBasicMaterial({
                color: 0x9C27B0,
                emissive: 0x4A148C
            });
            
            const nadph = new THREE.Mesh(nadphGeometry, nadphMaterial);
            nadph.position.set(8, 2, 0);
            
            nadph.userData = {
                velocity: new THREE.Vector3(0, 0.1, 0),
                life: 100,
                type: 'nadph'
            };
            
            scene.add(nadph);
            electrons.push(nadph);
        }
        
        function createATPMolecule() {
            const atpGeometry = new THREE.OctahedronGeometry(0.5, 0);
            const atpMaterial = new THREE.MeshBasicMaterial({
                color: 0x4CAF50,
                emissive: 0x2E7D32
            });
            
            const atp = new THREE.Mesh(atpGeometry, atpMaterial);
            atp.position.set(
                (Math.random() - 0.5) * 10 + 5,
                (Math.random() - 0.5) * 5 + 3,
                (Math.random() - 0.5) * 10
            );
            
            atp.userData = {
                velocity: new THREE.Vector3(0, 0.1, 0),
                life: 200,
                type: 'atp'
            };
            
            scene.add(atp);
            electrons.push(atp);
        }
        
        function createCO2Molecule() {
            const co2Geometry = new THREE.SphereGeometry(0.3, 8, 8);
            const co2Material = new THREE.MeshBasicMaterial({
                color: 0x607D8B,
                transparent: true,
                opacity: 0.8
            });
            
            const co2 = new THREE.Mesh(co2Geometry, co2Material);
            co2.position.set(
                (Math.random() - 0.5) * 30,
                20 + Math.random() * 10,
                (Math.random() - 0.5) * 30
            );
            
            co2.userData = {
                velocity: new THREE.Vector3(0, -0.3, 0),
                life: 150,
                type: 'co2'
            };
            
            scene.add(co2);
            photons.push(co2);
        }
        
        function createGlucoseMolecule() {
            const glucoseGeometry = new THREE.BoxGeometry(0.8, 0.8, 0.8);
            const glucoseMaterial = new THREE.MeshBasicMaterial({
                color: 0xFFC107,
                emissive: 0xFF8F00,
                emissiveIntensity: 0.3
            });
            
            const glucose = new THREE.Mesh(glucoseGeometry, glucoseMaterial);
            glucose.position.set(
                (Math.random() - 0.5) * 10,
                -5,
                (Math.random() - 0.5) * 10
            );
            
            glucose.userData = {
                velocity: new THREE.Vector3(0, 0.05, 0),
                life: 300,
                type: 'glucose'
            };
            
            scene.add(glucose);
            electrons.push(glucose);
        }

        function createElectron() {
            const electronGeometry = new THREE.SphereGeometry(0.15, 8, 8);
            const electronMaterial = new THREE.MeshBasicMaterial({
                color: 0x00ffff,
                emissive: 0x006666,
                emissiveIntensity: 1
            });

            const electron = new THREE.Mesh(electronGeometry, electronMaterial);
            electron.position.set(0, 0, 0);
            
            electron.userData = {
                angle: 0,
                radius: 8,
                speed: 0.15,
                center: new THREE.Vector3(0, 0, 0)
            };

            scene.add(electron);
            electrons.push(electron);
        }

        function onMouseMove(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(molecules, true);
            const tooltip = document.getElementById('moleculeTooltip');
            
            if (intersects.length > 0) {
                const molecule = intersects[0].object.parent;
                const data = molecule.userData.data;
                
                if (data) {
                    tooltip.innerHTML = `<strong>${data.name}</strong><br>${data.formula}`;
                    tooltip.style.left = event.clientX + 'px';
                    tooltip.style.top = event.clientY + 'px';
                    tooltip.classList.add('show');
                    
                    document.getElementById('active-molecule').textContent = data.name;
                    document.getElementById('molecule-type').textContent = data.formula;
                    document.getElementById('atom-count').textContent = data.atoms.length;
                }
            } else {
                tooltip.classList.remove('show');
                document.getElementById('active-molecule').textContent = '-';
                document.getElementById('molecule-type').textContent = '-';
                document.getElementById('atom-count').textContent = '-';
            }
        }

        function onMouseClick(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(molecules, true);
            
            if (intersects.length > 0) {
                selectedMolecule = intersects[0].object.parent;
                updateMoleculeDetail(selectedMolecule);
                
                // Highlight selected molecule
                molecules.forEach(mol => {
                    mol.children.forEach(child => {
                        if (child.material && child.material.emissive) {
                            child.material.emissive.setHex(0x000000);
                        }
                    });
                });
                
                selectedMolecule.children.forEach(child => {
                    if (child.material && child.material.emissive) {
                        child.material.emissive.setHex(0x222200);
                    }
                });
            }
        }

        function updatePhaseInfo() {
            document.getElementById('current-phase').textContent = phases[currentPhase];
            document.getElementById('phaseIndicator').textContent = `üìç ${phases[currentPhase]} Fazƒ±`;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        let lastTime = 0;
        const targetFPS = 30; // FPS sƒ±nƒ±rƒ± - performans i√ßin
        const frameInterval = 1000 / targetFPS;
        
        function animate(currentTime = 0) {
            requestAnimationFrame(animate);
            
            // FPS sƒ±nƒ±rlamasƒ± 
            if (currentTime - lastTime < frameInterval) {
                return;
            }
            lastTime = currentTime;

            if (isAnimating) {
                // Detay modellerindeki animasyonlar
                if (currentDetailModel) {
                    animateDetailModel(currentDetailModel);
                    
                    // Elektron Ta≈üƒ±ma Zinciri modeli i√ßin √∂zel animasyonlar
                    if (currentDetailModel.userData.type === 'electron_transport') {
                        currentDetailModel.traverse(function(object) {
                            if (object.userData && object.userData.type) {
                                switch(object.userData.type) {
                                    case 'moving_electron':
                                        // Elektron hareket animasyonu - Z-scheme boyunca
                                        if (object.userData.pathIndex !== undefined) {
                                            const pathPoints = [
                                                new THREE.Vector3(-12, 3.5, 0),
                                                new THREE.Vector3(-8, 2, 0),
                                                new THREE.Vector3(-6, 1, 0),
                                                new THREE.Vector3(-2, 1.5, 0),
                                                new THREE.Vector3(2, 3, 0),
                                                new THREE.Vector3(5, 3.5, 0),
                                                new THREE.Vector3(8, 3.5, 0),
                                                new THREE.Vector3(11, 3, 0),
                                                new THREE.Vector3(14, 2.5, 0)
                                            ];
                                            
                                            object.userData.pathIndex += 0.015; // Daha yava≈ü hareket
                                            if (object.userData.pathIndex >= pathPoints.length - 1) {
                                                object.userData.pathIndex = 0; // Ba≈üa d√∂n
                                            }
                                            
                                            const currentIndex = Math.floor(object.userData.pathIndex);
                                            const nextIndex = Math.min(currentIndex + 1, pathPoints.length - 1);
                                            const t = object.userData.pathIndex - currentIndex;
                                            
                                            object.position.lerpVectors(
                                                pathPoints[currentIndex],
                                                pathPoints[nextIndex],
                                                t
                                            );
                                            
                                            // Parlama efekti
                                            const intensity = 0.7 + 0.3 * Math.sin(currentTime * 0.01);
                                            object.material.emissiveIntensity = intensity;
                                        }
                                        break;
                                    case 'plastoquinone':
                                        // PQ molek√ºllerini d√∂nd√ºr
                                        object.rotation.x += 0.008;
                                        object.rotation.y += 0.006;
                                        break;
                                    case 'copper':
                                        // Bakƒ±r atomlarƒ±nƒ±n parlama efekti
                                        const copperIntensity = 0.6 + 0.4 * Math.sin(currentTime * 0.003);
                                        object.material.emissiveIntensity = copperIntensity;
                                        break;
                                    case 'P680':
                                    case 'P700':
                                        // Klorofil reaksiyon merkezleri parlama
                                        const chloroIntensity = 0.6 + 0.4 * Math.sin(currentTime * 0.002 + object.position.x * 0.1);
                                        object.material.emissiveIntensity = chloroIntensity;
                                        break;
                                }
                            }
                        });
                    }
                } else {
                    // Photon animasyonlarƒ± - optimized
                    for (let i = photons.length - 1; i >= 0; i--) {
                        const photon = photons[i];
                        photon.position.add(photon.userData.velocity);
                        photon.rotation.y += 0.1; // Sadece Y rotasyonu
                        photon.userData.life--;
                        
                        // Basit mesafe kontrol√º
                        if (photon.userData.life <= 0 || photon.position.y < -30) {
                            scene.remove(photon);
                            photons.splice(i, 1);
                        }
                    }
                }

                // Electron animasyonlarƒ± - optimized
                for (let i = electrons.length - 1; i >= 0; i--) {
                    const electron = electrons[i];
                    if (electron.userData.angle !== undefined) {
                        electron.userData.angle += electron.userData.speed || 0.1;
                        const x = Math.cos(electron.userData.angle) * (electron.userData.radius || 5);
                        const z = Math.sin(electron.userData.angle) * (electron.userData.radius || 5);
                        electron.position.set(x, 2, z);
                        
                        if (electron.userData.angle > Math.PI * 4) { // Daha kƒ±sa d√∂ng√º
                            scene.remove(electron);
                            electrons.splice(i, 1);
                        }
                    }
                }

                // Chloroplast rotasyonu - yava≈ülatƒ±ldƒ±
                if (chloroplast) {
                    chloroplast.rotation.y += 0.001;
                }
            }

            // Molek√ºl lifecycle y√∂netimi
            manageMoleculeLifecycle();
            
            // Kontrolleri g√ºncelle
            controls.update();
            
            // Render
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>